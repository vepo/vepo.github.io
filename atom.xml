<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://blog.vepo.dev/atom.xml" rel="self" type="application/atom+xml" /><link href="https://blog.vepo.dev/" rel="alternate" type="text/html" /><updated>2026-02-21T19:42:20+00:00</updated><id>https://blog.vepo.dev/atom.xml</id><title type="html">vepo</title><subtitle>Um repositório para todos os posts, palestras e tutoriais que já fiz. Java, Desenvolvimento de Software e reflexões sobre filosofia</subtitle><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><entry><title type="html">SQL na Prática: Criando e Atualizando tabelas</title><link href="https://blog.vepo.dev/posts/criando-tabelas-com-sql" rel="alternate" type="text/html" title="SQL na Prática: Criando e Atualizando tabelas" /><published>2026-02-20T00:00:00+00:00</published><updated>2026-02-20T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/16-35-00-criando-e-atualizando-tabelas</id><content type="html" xml:base="https://blog.vepo.dev/posts/criando-tabelas-com-sql"><![CDATA[<div class="paragraph">
<p>No post anterior, aprendemos como consultar e modificar dados. Talvez você não tenha tido a curiosidade de se perguntar como as tabelas foram criadas, apesar do script ter sido fornecido, mas agora é o momento de dar um passo atrás e explicar: como criar e atualizar as próprias tabelas.</p>
</div>
<div class="sect1">
<h2 id="_o-que-é-o-esquema-de-uma-tabela">O que é o esquema de uma tabela?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Uma das principais vantagens dos bancos de dados relacionais é que o sistema gerencia e garante a consistência dos dados, e isso é feito por meio do esquema do banco de dados.</p>
</div>
<div class="paragraph">
<p>Como já definimos antes, o esquema (ou <strong>schema</strong>) é a descrição de uma coleção de dados que estabelece a estrutura de armazenamento.</p>
</div>
<div class="paragraph">
<p>No modelo relacional, os dados são organizados em relações compostas por atributos, em que cada linha de uma tabela representa uma entidade em si. Dessa forma, o esquema de um banco tem a responsabilidade de definir:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Quais são as relações (tabelas) e seus nomes;</p>
</li>
<li>
<p>Quais atributos cada relação contém;</p>
</li>
<li>
<p>Como as relações se relacionam entre si;</p>
</li>
<li>
<p>Quais restrições de integridade se aplicam a cada atributo;</p>
</li>
<li>
<p>Qual o tipo de dados armazenado em cada atributo.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nesse post vamos ver como criar e atualizar tabelas, ou seja, como definir e modificar o esquema do banco de dados.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_como-faço-para-criar-uma-tabela">Como faço para criar uma tabela?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para criar uma tabela em SQL, usamos o comando <code>CREATE TABLE</code>. Vamos usar o exemplo de criação mencionado anteriormente para ilustrar:</p>
</div>
<div class="listingblock">
<div class="title">Criando a tabela "employees"</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="p">(</span>
    <span class="n">employee_id</span>   <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">first_name</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phone</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">hire_date</span>     <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">job_title</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">salary</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">manager_id</span>    <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="n">created_at</span>    <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_como-definir-os-tipos-de-dados-dos-atributos">Como definir os tipos de dados dos atributos?</h3>
<div class="paragraph">
<p>No exemplo acima, criamos a tabela <code>employees</code> com vários atributos, cada um com seu tipo de dado e restrições específicas. Podemos ver, por exemplo, o atributo <code>phone</code>, que é do tipo <code>VARCHAR(20)</code> e não possui nenhuma restrição de integridade. <code>VARCHAR</code> significa que o campo armazenará uma cadeia de caracteres (texto) com tamanho variável, mesmo tendo definido que o tamanho máximo é 20 caracteres. Alguns dos possíveis tipos de dados em PostgreSQL são listados na tabela abaixo:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabela 1. Tipos de dados comuns em PostgreSQL e MySQL, para referência acesse <a href="https://www.postgresql.org/docs/current/datatype.html" class="bare">https://www.postgresql.org/docs/current/datatype.html</a> ou <a href="https://dev.mysql.com/doc/refman/8.4/en/data-types.html" class="bare">https://dev.mysql.com/doc/refman/8.4/en/data-types.html</a></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">PostgreSQL</th>
<th class="tableblock halign-center valign-top">MySQL</th>
<th class="tableblock halign-left valign-top">Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INT</code> ou <code>INTEGER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>INT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números inteiros (sem casas decimais).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números inteiros grandes (64 bits), usados para armazenar valores maiores que os inteiros normais.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code> ou <code>NUMERIC(p,s)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DECIMAL(p,s)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números decimais com precisão definida. <code>p</code> é a precisão total (número total de dígitos) e <code>s</code> é a escala (número de dígitos à direita da vírgula).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>FLOAT</code> ou <code>REAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números de ponto flutuante (números com casas decimais).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>SERIAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números inteiros auto-incrementáveis, geralmente usados para chaves primárias.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BIGSERIAL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Números inteiros grandes auto-incrementáveis, usados para chaves primárias quando se espera um grande volume de dados.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VARCHAR(n)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VARCHAR(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cadeia de caracteres (texto) com tamanho variável. O número entre parênteses indica o tamanho máximo permitido.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CHAR(n)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CHAR(n)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cadeia de caracteres (texto) com tamanho fixo. O número entre parênteses indica o tamanho exato.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TEXT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TEXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cadeia de caracteres (texto) de tamanho ilimitado.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data no formato AAAA-MM-DD.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hora no formato HH:MM:SS.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data e hora no formato AAAA-MM-DD HH:MM:SS.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BOOLEAN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valores lógicos: <code>TRUE</code> ou <code>FALSE</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>No nosso exemplo, também usamos os seguintes tipos: <code>SERIAL</code>, <code>VARCHAR</code>, <code>DATE</code>, <code>DECIMAL</code> e <code>TIMESTAMP</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-garantir-a-integridade-do-dado">Como garantir a integridade do dado?</h3>
<div class="paragraph">
<p>Além dos tipos de dados, as restrições de integridade (conhecidas como <strong>constraints</strong>) são fundamentais para garantir que os dados armazenados estejam sempre consistentes e válidos. No exemplo da tabela <code>employees</code>, utilizamos diversas restrições:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="p">(</span>
    <span class="n">employee_id</span>   <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">first_name</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phone</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">hire_date</span>     <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">job_title</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">salary</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">manager_id</span>    <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="n">created_at</span>    <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_constraints-em-nível-de-coluna-vs-nível-de-tabela">Constraints em nível de coluna vs. nível de tabela</h4>
<div class="paragraph">
<p>No exemplo acima, todas as constraints foram definidas <strong>diretamente na coluna</strong>, o que chamamos de <strong>constraints em nível de coluna</strong>. Porém, o SQL também permite definir constraints <strong>separadamente, ao final da criação da tabela</strong> - são as <strong>constraints em nível de tabela</strong>. Esta sintaxe é especialmente útil quando:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A constraint envolve múltiplas colunas (como uma chave primária composta)</p>
</li>
<li>
<p>Queremos dar um nome significativo à constraint para facilitar manutenção futura</p>
</li>
<li>
<p>Precisamos de mais clareza na definição das regras de negócio</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos refatorar a criação da tabela <code>employees</code> usando constraints em nível de tabela:</p>
</div>
<div class="listingblock">
<div class="title">Criando a tabela "employees" com constraints em nível de tabela</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="p">(</span>
    <span class="n">employee_id</span>   <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="n">first_name</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phone</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">hire_date</span>     <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">job_title</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">salary</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">manager_id</span>    <span class="nb">INT</span><span class="p">,</span>
    <span class="n">created_at</span>    <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>

    <span class="c1">-- Constraints em nível de tabela</span>
    <span class="k">CONSTRAINT</span> <span class="n">employees_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">employees_email_unique</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">employees_salary_check</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">employees_manager_fk</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">manager_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Observe as diferenças:
- A <code>PRIMARY KEY</code> agora é definida como uma constraint nomeada <code>employees_pk</code>
- O <code>UNIQUE</code> para email também ganhou um nome descritivo
- O <code>CHECK</code> do salário foi nomeado
- A chave estrangeira <code>manager_id</code> agora é explicitamente definida com <code>FOREIGN KEY</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_vantagens-de-nomear-constraints">Vantagens de nomear constraints</h4>
<div class="paragraph">
<p>Dar nomes às constraints traz benefícios importantes:
- <strong>Mensagens de erro mais claras</strong>: Quando uma violação ocorre, o nome da constraint aparece na mensagem de erro
- <strong>Manutenção mais fácil</strong>: Para remover ou modificar uma constraint, precisamos referenciá-la pelo nome
- <strong>Documentação</strong>: Os nomes podem descrever a regra de negócio implementada</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constraints-com-múltiplas-colunas">Constraints com múltiplas colunas</h3>
<div class="paragraph">
<p>Um dos casos mais comuns onde precisamos de constraints em nível de tabela é quando a restrição envolve mais de uma coluna. Vamos criar uma tabela <code>project_assignments</code> para alocar funcionários em projetos:</p>
</div>
<div class="listingblock">
<div class="title">Criando uma tabela com chave primária composta</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">project_assignments</span> <span class="p">(</span>
    <span class="n">employee_id</span>   <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">project_id</span>    <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">assigned_date</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">role</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">hours_weekly</span>  <span class="nb">INT</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">hours_weekly</span> <span class="k">BETWEEN</span> <span class="mi">1</span> <span class="k">AND</span> <span class="mi">40</span><span class="p">),</span>

    <span class="c1">-- Chave primária composta: um funcionário só pode ser alocado uma vez no mesmo projeto</span>
    <span class="k">CONSTRAINT</span> <span class="n">project_assignments_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">employee_id</span><span class="p">,</span> <span class="n">project_id</span><span class="p">),</span>

    <span class="c1">-- Chaves estrangeiras</span>
    <span class="k">CONSTRAINT</span> <span class="n">project_assignments_employee_fk</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">employee_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">project_assignments_project_fk</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">project_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">projects</span><span class="p">(</span><span class="n">project_id</span><span class="p">),</span>

    <span class="c1">-- Garantir que a data de atribuição não seja futura</span>
    <span class="k">CONSTRAINT</span> <span class="n">project_assignments_date_check</span>
        <span class="k">CHECK</span> <span class="p">(</span><span class="n">assigned_date</span> <span class="o">&lt;=</span> <span class="k">CURRENT_DATE</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste exemplo, a chave primária é <strong>composta</strong> por <code>employee_id</code> e <code>project_id</code>, garantindo que um funcionário não possa ser alocado duas vezes no mesmo projeto. Observe como a sintaxe em nível de tabela torna isso claro e explícito.</p>
</div>
</div>
<div class="sect2">
<h3 id="_outros-exemplos-com-tabelas-existentes">Outros exemplos com tabelas existentes</h3>
<div class="paragraph">
<p>Vamos recriar as tabelas <code>departments</code> e <code>projects</code> usando a sintaxe de constraints em nível de tabela:</p>
</div>
<div class="listingblock">
<div class="title">Recriando a tabela "departments"</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">departments</span> <span class="p">(</span>
    <span class="n">department_id</span>   <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="n">department_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">budget</span>          <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">manager_id</span>      <span class="nb">INT</span><span class="p">,</span>

    <span class="k">CONSTRAINT</span> <span class="n">departments_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">department_id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">departments_name_unique</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">department_name</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">departments_budget_check</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">budget</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">departments_manager_fk</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">manager_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Recriando a tabela "projects"</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">projects</span> <span class="p">(</span>
    <span class="n">project_id</span>    <span class="nb">SERIAL</span><span class="p">,</span>
    <span class="n">project_name</span>  <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">start_date</span>    <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">end_date</span>      <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">department_id</span> <span class="nb">INT</span><span class="p">,</span>

    <span class="k">CONSTRAINT</span> <span class="n">projects_pk</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">project_id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">projects_dates_check</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">end_date</span> <span class="o">&gt;</span> <span class="n">start_date</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">projects_department_fk</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">department_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">departments</span><span class="p">(</span><span class="n">department_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_constraints-de-verificação-com-múltiplas-colunas">Constraints de verificação com múltiplas colunas</h4>
<div class="paragraph">
<p>Podemos criar constraints <code>CHECK</code> que envolvem múltiplas colunas. Por exemplo, vamos adicionar uma regra que impede um funcionário de ser gerente de si mesmo:</p>
</div>
<div class="listingblock">
<div class="title">Adicionando constraint para evitar auto-gerenciamento</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">employees_no_self_management</span>
<span class="k">CHECK</span> <span class="p">(</span><span class="n">employee_id</span> <span class="o">!=</span> <span class="n">manager_id</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_e-se-eu-precisar-modificar-uma-tabela-existente">E se eu precisar modificar uma tabela existente?</h3>
<div class="paragraph">
<p>Após criar uma tabela, podemos precisar alterá-la. O comando <code>ALTER TABLE</code> permite modificar a estrutura existente:</p>
</div>
<div class="listingblock">
<div class="title">Adicionando uma nova coluna</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">birth_date</span> <span class="nb">DATE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Modificando o tipo de uma coluna</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">phone</span> <span class="k">TYPE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Adicionando uma constraint (com nome)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">employees_phone_unique</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">phone</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Removendo uma constraint (precisamos do nome!)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">employees_phone_unique</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Removendo uma coluna</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">birth_date</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note que para remover uma constraint, <strong>precisamos saber seu nome</strong>. É por isso que nomear constraints é uma boa prática!</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-remover-uma-tabela">Como remover uma tabela?</h3>
<div class="paragraph">
<p>Para remover uma tabela completamente, usamos o comando <code>DROP TABLE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">project_assignments</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cuidado!</strong> Este comando remove a tabela e todos os seus dados permanentemente.</p>
</div>
<div class="paragraph">
<p>Se a tabela for referenciada por uma chave estrangeira, você precisará usar <code>CASCADE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">departments</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Isso removerá a tabela <code>departments</code> e todas as dependências (como a chave estrangeira em <code>projects</code> e <code>project_assignments</code>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neste post, aprendemos a criar e gerenciar o esquema de um banco de dados relacional. Vimos que:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>O comando <code>CREATE TABLE</code> define a estrutura inicial das tabelas</p>
</li>
<li>
<p>Os tipos de dados determinam que tipo de informação cada coluna pode armazenar</p>
</li>
<li>
<p>As restrições de integridade (<strong>constraints</strong>) garantem a consistência dos dados</p>
</li>
<li>
<p><strong>Constraints podem ser definidas em nível de coluna ou nível de tabela</strong></p>
</li>
<li>
<p><strong>Constraints em nível de tabela são obrigatórias para chaves primárias compostas</strong></p>
</li>
<li>
<p><strong>Nomear constraints facilita a manutenção e fornece mensagens de erro mais claras</strong></p>
</li>
<li>
<p>O comando <code>ALTER TABLE</code> permite modificar tabelas existentes</p>
</li>
<li>
<p>O comando <code>DROP TABLE</code> remove tabelas (com cuidado!)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dominar a criação e modificação de tabelas é fundamental para qualquer profissional que trabalhe com bancos de dados. Uma boa modelagem inicial, com restrições bem definidas, evita problemas de inconsistência e facilita a manutenção do sistema no longo prazo.</p>
</div>
<div class="paragraph">
<p>No próximo post, veremos como consultar dados de múltiplas tabelas usando <code>JOINs</code> para explorar os relacionamentos que definimos aqui. Até lá!</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="SQL" /><category term="PostgreSQL" /><category term="Banco de Dados" /><category term="Modelagem de Dados" /><category term="Backend" /><category term="Desenvolvimento Web" /><summary type="html"><![CDATA[Aprenda a criar e modificar tabelas em SQL com exemplos práticos em PostgreSQL. Descubra a diferença entre constraints em nível de coluna e tabela, chaves primárias compostas, e como nomear constraints para facilitar a manutenção do banco de dados.]]></summary></entry><entry><title type="html">SQL na Prática: Consultas, Inserções e Atualizações de dados com PostgreSQL</title><link href="https://blog.vepo.dev/posts/sql-na-pratica" rel="alternate" type="text/html" title="SQL na Prática: Consultas, Inserções e Atualizações de dados com PostgreSQL" /><published>2026-01-22T00:00:00+00:00</published><updated>2026-01-22T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/18-13-00-sql-na-pratica</id><content type="html" xml:base="https://blog.vepo.dev/posts/sql-na-pratica"><![CDATA[<div class="paragraph">
<p>Agora que sabemos o que são bancos de dados, como são estruturados internamentes e como modelar um banco de dados, vamos entrar a fundo na linguagem SQL, mostrando toda a potencialidade dela.</p>
</div>
<div class="sect1">
<h2 id="_como-e-quando-usar-sql">Como e quando usar SQL?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL é a linguagem de comunicação com bases de dados relacionais. Quando vamos usar um banco de dados relacional, é quase certo que podemos usar uma linguagem em comum com ele para consultar, adicionar ou remover dados, mas o SQL possui outras funcionalidades além do acesso ao dados. Através do SQL é possível gerenciar transações e permissões, assuntos ainda não cobertos.</p>
</div>
<div class="sect2">
<h3 id="_então-todo-banco-relacional-implementa-sql">Então todo banco relacional implementa SQL?</h3>
<div class="paragraph">
<p>Sim e não. Na verdade quase todo banco considerado relacional dá algum suporte a linguagem SQL, mas isso não significa que ele implementa todas as funcionalidade. É preciso lembrar que SQL é um padrão em constante evolução e que nem todas as funcionalidades fazem sentido para todos os bancos.</p>
</div>
<div class="paragraph">
<p>Alguns bancos também podem optar por fazer adaptações, ou extensões, da linguagem, por isso é importante conhecer a documentação do banco que se está usando. Aqui usaremos o PostgreSQL como exemplo, então, caso queira um tutorial, recomendo seguir o do <a href="https://www.w3schools.com/sql/default.asp">W3Schools</a> ou a <a href="https://www.postgresql.org/docs/18/index.html">documentação oficial do PostgreSQL</a>.</p>
</div>
<div class="paragraph">
<p>Para melhor didática vamos começar a configurar o ambiente do zero criando e configurando uma base de dados. Então acessa o repositório <a href="https://github.com/vepo/sql-database-tutorial">github.com/vepo/sql-database-tutorial</a> e segue pelo tópico <a href="https://github.com/vepo/sql-database-tutorial/blob/main/docs/03-sql-tutorial.md">3. SQL Tutorial: Database Navigation and Querying</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-é-o-modelo-de-dados-que-estamos-trabalhando">Como é o modelo de dados que estamos trabalhando?</h3>
<div class="paragraph">
<p>Antes de começarmos, precisamos brevemente entender o modelo de dados que vamos usar. Vamos usar uma base de dados que mapeia a estrutura de uma empresa. Quais funcionários existem, quais departamentos eles estão alocados, quais são os orçamentos alocados e quais projetos existem. Na imagem abaixo, está o diagrama de entidades e mais abaixo o script usando para criação das tabelas.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/databases/company_db_diagram.png" alt="company db diagram">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">employees</span> <span class="p">(</span>
    <span class="n">employee_id</span>   <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">first_name</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phone</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">hire_date</span>     <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">job_title</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">department_id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">salary</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">manager_id</span>    <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="n">created_at</span>    <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>

<span class="c1">-- Departments table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">departments</span> <span class="p">(</span>
    <span class="n">department_id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">department_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">location</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">budget</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">manager_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Projects table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">projects</span> <span class="p">(</span>
    <span class="n">project_id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">project_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">start_date</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">end_date</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">budget</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">status</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">status</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'Planning'</span><span class="p">,</span> <span class="s1">'Active'</span><span class="p">,</span> <span class="s1">'On Hold'</span><span class="p">,</span> <span class="s1">'Completed'</span><span class="p">,</span> <span class="s1">'Cancelled'</span><span class="p">))</span>
<span class="p">);</span>

<span class="c1">-- Employee projects (junction table)</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">employee_projects</span> <span class="p">(</span>
    <span class="n">employee_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">employees</span><span class="p">(</span><span class="n">employee_id</span><span class="p">),</span>
    <span class="n">project_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">projects</span><span class="p">(</span><span class="n">project_id</span><span class="p">),</span>
    <span class="k">role</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">hours_worked</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">employee_id</span><span class="p">,</span> <span class="n">project_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>É importante notar a cardinalidade de alguns elementos. Um funcionário trabalha para um departamento que possui um gerente. Cada funcionário também possui um gerente, que pode não ser o mesmo do departamento. Cada funcionátrio trabalha em vários projetos, possuindo papeis diferentes. Os projetos não são ligados aos departamentos, podendo ter funcionários de diversos departamentos.</p>
</div>
<div class="paragraph">
<p>O modelo é propositadamente complexo para possibilitar a elaborações de <em>queries</em> com junções e <em>subqueires</em>. A pessoa que deseja escrever queries tem que estar ciente da cardinalidade das relações para que não sejam extraídas informações inverídicas.</p>
</div>
<div class="paragraph">
<p>Já que conhecemos o modelo de dados, podemos partir para a interação com ele.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-conectar-com-uma-base-de-dados">Como conectar com uma base de dados?</h3>
<div class="paragraph">
<p>Todo desenvolvedor comumente se refere aos <strong>Sistemas de Gerenciamento de Banco de Dados</strong> (SGDB, ou DBMS de <em>Database Management System</em>) como base de dados ou databases, mas uma instância do PostgreSQL, ou de qualquer outra base de dados, pode gerenciar diversas base de dados em paralelo.</p>
</div>
<div class="paragraph">
<p>Normalmente quando nossa aplicação conecta com um banco de dados, precisamos saber o <em>hostname</em>, a porta e o banco de dados que queremos nos conectar. Mas como vamos conectar localmente usando as ferramentas de linha de comando, não precisamos dessas informações. Mas precisamos selecionar, dentro do programa, qual base de dados queremos usar.</p>
</div>
<div class="paragraph">
<p>Todo SGDB pode conter mais de uma base de dados e cada base de dados pode conter mais de uma tabela, tanto que existe uma série de comandos para criar a apagar bases de dados, que são comuns na linguagem SQL. Mas a forma como selecionamos qual base estamos usando varia de acordo com a base em uso. Para PostgreSQL, se usa <code>\c company_db</code>, já no <a href="https://dev.mysql.com/doc/refman/8.4/en/database-use.html">MySQL</a> e no <a href="https://learn.microsoft.com/en-us/sql/t-sql/language-elements/use-transact-sql?view=sql-server-ver17">SQL Server</a> se usa <code>USE company_db</code>.</p>
</div>
<div class="listingblock">
<div class="title">Comando SQL para criar uma base de dados</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">company_db</span><span class="p">;</span> <span class="c1">-- Cria um banco de dados chamado 'company_db'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Comando SQL para destruir uma base de dados</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">company_db</span><span class="p">;</span> <span class="c1">-- Destruir um banco de dados chamado 'company_db'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Comando SQL para usar uma base de dados no PostgreSQL</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="err">\</span><span class="k">c</span> <span class="n">company_db</span> <span class="c1">-- Acessando um banco de dados chamado 'company_db'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Então agora que conectamos a nossa base de dados dentro do SGDB, vamos criar <em>queries</em>?</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-escrever-consultas-queries">Como escrever consultas (<em>queries</em>)?</h3>
<div class="paragraph">
<p>É preciso lembrar que qualquer consulta a uma base de dados SQL envolve o conceito de Algébra Relacional já discutido anteriormente. Consultas são feitas usando o comando <code>SELECT</code> que sempre é construído através do padrão <code>SELECT &lt;atributos&gt; FROM &lt;relação&gt;</code>, onde <strong>atributos</strong> é o conjunto de colunas que desejamos selecionar e <strong>relação</strong> é as tabelas ou qualquer outra consulta. Dessa forma a consulta mais simples que podemos fazer é listar todos as linhas e todas as colunas de uma tabela, conforme feito abaixo com a tabela <code>departments</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">departments</span><span class="p">;</span> <span class="c1">-- '*' significa a seleção de todos os atributos presentes na relação</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Uma consulta, em muitas situações, pode não ser eficiente, porque é bom lembrar que ao enviar uma consulta para um SGDB, este terá que consultar o disco para encontrar todas as linhas e todos os atributos e enviar de volta para o cliente. Essa operação pode ser bastante demorada devido ao tempo de acesso ao disco, e ao tempo de envio dessa informação entre os processos. Por isso é muito incomum fazer esse tipo de requisição em sistemas.</p>
</div>
<div class="sect3">
<h4 id="_consultas-com-seleção-e-projeção">Consultas com Seleção e Projeção</h4>
<div class="paragraph">
<p>Em sistemas, praticamente todas as consultas passam pelas operações de seleção e projeção para se evitar o acesso desncessário ao dados. Isso é feito para que não se adicione latência a operação sendo realizada e para que o sistema não use memória desnecessária.</p>
</div>
<div class="paragraph">
<p>Vamos supor que eu precise saber o identificador e a cidades em que está localizado um determinado departamento, ignorando o budget e o gerente do mesmo. Ao invés de selecionar todos os departamentos, posso fazer uma consulta específica como a consulta abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">department_id</span><span class="p">,</span> <span class="k">location</span> <span class="k">FROM</span> <span class="n">departments</span> <span class="k">WHERE</span> <span class="n">department_name</span> <span class="o">=</span> <span class="s1">'Sales'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Na consulta acima, extendemos nossa consulta inicial para fazer a projeção através do conjunto de atributos 'department_id, location' da relação que contêm todos os elementos da tabela <code>departments</code> com o nome Sales, ou seja, pegamos a tabela <code>departments</code> e aplicamos uma seleção.</p>
</div>
<div class="paragraph">
<p>Em toda consulta, podemos adicionar a declaração <code>WHERE</code> para filtrar, durante a leitura, as linhas que serão consideradas parte da relação. A declaração <code>WHERE</code> será composta por um predicado booleano que ao ser aplicado em cada linha define se a mesma pode ser adicionada ou não na relação. Esse predicado pode ter outras consultas, como no caso abaixo.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que lista todos os departamentos que não possuem funcionários alocados.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">department_id</span><span class="p">,</span>
       <span class="k">location</span>

<span class="k">FROM</span> <span class="n">departments</span>

<span class="k">WHERE</span> <span class="n">department_id</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">department_id</span>
                            <span class="k">FROM</span> <span class="n">employees</span>
                            <span class="k">WHERE</span> <span class="n">department_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
                           <span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_consultas-com-junção">Consultas com Junção</h4>
<div class="paragraph">
<p>Outra funcionalidade importantíssima do SQL é a possibilidade de fazer junções entre tabelas. No nosso modelo podemos identificar diversas tabelas com relacionamentos e todos esses relacionamentos podem ser escritos na forma de junções. Por exemplo, se desejarmos saber qual é o custo de um departamento e o valor alocado para mesmo, podem ser tentado a fazer esse calculo usando as tabelas <code>departments</code>, <code>employees</code>, <code>employee_projects</code> e <code>projects</code>.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que faz uma agregação por departamento do gasto pessoal. O valor calculado está incorreto.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">budget</span><span class="p">,</span>
    <span class="k">SUM</span><span class="p">(</span><span class="n">prj</span><span class="p">.</span><span class="n">budget</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_budget</span><span class="p">,</span>
    <span class="k">SUM</span><span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span> <span class="k">as</span> <span class="n">employee_salaries</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="n">dep</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">employees</span> <span class="n">emp</span> <span class="k">ON</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">employee_projects</span> <span class="n">emp_prj</span> <span class="k">ON</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">employee_id</span> <span class="o">=</span> <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">projects</span> <span class="n">prj</span> <span class="k">ON</span> <span class="n">prj</span><span class="p">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">project_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span> <span class="k">ASC</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Porque o valor calculado está incorreto?</div>
O valor calculado na consulta acima está incorreto porque a junção entre as tabelas <code>employees</code>, <code>employee_projects</code> e <code>projects</code> cria uma relação com cardinalidade maior do que a original. Isso acontece porque um funcionário pode trabalhar em vários projetos, então ao fazer a junção, cada linha do funcionário é replicada para cada projeto que ele trabalha. Isso faz com que o salário do funcionário seja somado várias vezes, uma para cada projeto, resultando em um valor total incorreto.
</div>
</div>
<div class="paragraph">
<p>Na consulta acima foi utilizado três novas declarações que quero explicar aqui. <code>JOIN</code>, <code>GROUP BY</code> e <code>ORDER BY</code>.</p>
</div>
<div class="paragraph">
<p>Os <code>JOIN</code> são usados para fazer junções entre tabelas, ou seja, criar uma nova relação a partir de duas outras. No exemplo acima, foi usado o <code>LEFT JOIN</code> que cria uma nova relação com todas as linhas da tabela da esquerda e as linhas da tabela da direita que satisfazem a condição dada. Caso não existam linhas na tabela da direita que satisfaçam a condição, então os atributos dessas linhas serão nulos. Existem outros tipos de <code>JOIN</code>, que veremos a seguir.</p>
</div>
<div class="paragraph">
<p>O <code>GROUP BY</code> é usado para agrupar linhas que possuem o mesmo valor em determinados atributos. No exemplo acima, todas as linhas que possuem o mesmo <code>department_id</code> são agrupadas em uma única linha. Isso é útil quando queremos fazer agregações, como somas ou médias, sobre grupos de linhas. <code>GROUP BY</code> não é obrigatório em todas as consultas, mas é necessário quando a cardinalidade da relação resulta em múltiplas linhas para o mesmo valor de um atributo que está sendo selecionado e podemos já requerer uma agregação dos dados, evitando processamento desnecessário no cliente.</p>
</div>
<div class="paragraph">
<p>O <code>ORDER BY</code> é usado para ordenar as linhas da relação resultante de acordo com os valores de um ou mais atributos. No exemplo acima, as linhas são ordenadas pelo atributo <code>department_name</code> em ordem crescente (<code>ASC</code>). Também é possível ordenar em ordem decrescente usando a palavra-chave <code>DESC</code>. Importante lembrar que o <code>ORDER BY</code> pode ser aplicado mesmo quando o <code>JOIN</code> ou o <code>GROUP BY</code> não são usados, foi usado aqui como demonstrativo apenas, ele pode ser usando em qualquer consulta.</p>
</div>
<div class="sect4">
<h5 id="_tipos-de-junção">Tipos de Junção</h5>
<div class="paragraph">
<p>Existem diversos tipos de junção que podem ser usados em SQL, cada um com suas características e usos específicos. Os principais tipos de junção são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>INNER JOIN</code>: Retorna apenas as linhas que possuem correspondência em ambas as tabelas. Ou seja, somente as linhas que satisfazem a condição de junção são incluídas na relação resultante.</p>
</li>
<li>
<p><code>LEFT JOIN</code> (ou <code>LEFT OUTER JOIN</code>): Retorna todas as linhas da tabela da esquerda e as linhas correspondentes da tabela da direita. Se não houver correspondência, os atributos da tabela da direita serão nulos.</p>
</li>
<li>
<p><code>RIGHT JOIN</code> (ou <code>RIGHT OUTER JOIN</code>): Retorna todas as linhas da tabela da direita e as linhas correspondentes da tabela da esquerda. Se não houver correspondência, os atributos da tabela da esquerda serão nulos.</p>
</li>
<li>
<p><code>FULL JOIN</code> (ou <code>FULL OUTER JOIN</code>): Retorna todas as linhas de ambas as tabelas. Se não houver correspondência, os atributos da tabela que não possui correspondência serão nulos.</p>
</li>
<li>
<p><code>CROSS JOIN</code>: Retorna o produto cartesiano das duas tabelas, ou seja, todas as combinações possíveis entre as linhas das duas tabelas. É o único tipo de <code>JOIN</code> que não requer uma condição de junção.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Uma junção sempre é feita entre duas tabelas e baseada em uma condição que define como as linhas das duas tabelas devem ser combinadas. A condição é definida após a palavra-chave <code>ON</code> e geralmente envolve a comparação de atributos que possuem algum tipo de relacionamento entre as tabelas. Por exemplo, na consulta abaixo, estamos fazendo um <code>INNER JOIN</code> entre as tabelas <code>employees</code> e <code>departments</code> com base no atributo <code>department_id</code>, que é comum a ambas as tabelas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">emp</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span>
       <span class="n">emp</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span>
       <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span>
<span class="k">FROM</span> <span class="n">employees</span> <span class="n">emp</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">departments</span> <span class="n">dep</span>
<span class="k">ON</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_funções-de-agregação">Funções de Agregação</h5>
<div class="paragraph">
<p>Na consulta que fizemos anteriormente, usamos a função de agregação <code>SUM</code> para calcular o total de salários dos funcionários em cada departamento. Funções de agregação são usadas para realizar cálculos em um conjunto de valores e retornar um único valor. As principais funções de agregação em SQL são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COUNT()</code>: Conta o número de linhas em um conjunto de resultados.</p>
</li>
<li>
<p><code>SUM()</code>: Calcula a soma dos valores em um conjunto de resultados.</p>
</li>
<li>
<p><code>AVG()</code>: Calcula a média dos valores em um conjunto de resultados.</p>
</li>
<li>
<p><code>MIN()</code>: Retorna o valor mínimo em um conjunto de resultados.</p>
</li>
<li>
<p><code>MAX()</code>: Retorna o valor máximo em um conjunto de resultados.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Funções de agregação são frequentemente usadas em conjunto com a cláusula <code>GROUP BY</code> para agrupar linhas e calcular valores agregados para cada grupo.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subconsultas">Subconsultas</h4>
<div class="paragraph">
<p>Outra funcionalidade poderosa do SQL é a capacidade de usar subconsultas, que são consultas aninhadas dentro de outras consultas. Subconsultas podem ser usadas em várias partes de uma consulta, como na cláusula <code>SELECT</code>, <code>FROM</code> ou <code>WHERE</code>. Elas permitem que você realize consultas mais complexas e dinâmicas.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que usa uma subconsulta na cláusula <code>WHERE</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">budget</span><span class="p">,</span>
    <span class="c1">-- Calcula o orçamento dos projetos separadamente</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">prj</span><span class="p">.</span><span class="n">budget</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
     <span class="k">FROM</span> <span class="n">projects</span> <span class="n">prj</span>
     <span class="k">JOIN</span> <span class="n">employee_projects</span> <span class="n">emp_prj</span> <span class="k">ON</span> <span class="n">prj</span><span class="p">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">project_id</span>
     <span class="k">JOIN</span> <span class="n">employees</span> <span class="n">emp</span> <span class="k">ON</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">employee_id</span> <span class="o">=</span> <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span>
     <span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_budget</span><span class="p">,</span>
    <span class="c1">-- Calcula o total de salários dos funcionários separadamente</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">salary</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
     <span class="k">FROM</span> <span class="n">employees</span> <span class="n">emp</span>
     <span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">employee_salaries</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="n">dep</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span> <span class="k">ASC</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A subconsulta acima calcula o orçamento dos projetos e o total de salários dos funcionários para cada departamento separadamente, evitando o problema de duplicação de linhas que ocorreu na consulta anterior. A subconsulta é executada para cada linha do resultado da consulta principal, permitindo que você obtenha valores dinâmicos com base nos dados atuais.</p>
</div>
<div class="paragraph">
<p>Talvez você tenha imaginado que essa consulta é mais lenta do que a anterior, mas na verdade, dependendo do otimizador de consultas do SGDB, essa consulta pode ser mais eficiente, pois evita a criação de relações intermediárias com cardinalidade maior do que o necessário.</p>
</div>
<div class="paragraph">
<p>Outra vantagem das subconsultas é a sua capacidade de tornar as consultas mais legíveis e fáceis de entender, especialmente quando lidamos com consultas complexas que envolvem várias tabelas e condições.</p>
</div>
<div class="paragraph">
<p>Nessa consulta, também usamos a função <code>COALESCE</code>, que retorna o primeiro valor não nulo em uma lista de argumentos. Isso é útil para garantir que, se não houver projetos ou funcionários em um departamento, o valor retornado seja 0 em vez de nulo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_common-table-expressions-ctes">Common Table Expressions (CTEs)</h4>
<div class="paragraph">
<p>Uma outra forma de estruturar consultas complexas em SQL é através do uso de Common Table Expressions (CTEs), que são definidas usando a cláusula <code>WITH</code>. CTEs permitem que você defina consultas temporárias que podem ser referenciadas dentro da consulta principal, tornando o código mais organizado e legível.</p>
</div>
<div class="paragraph">
<p>A consulta abaixo reescreve a consulta anterior usando CTEs para calcular o orçamento dos projetos e o total de salários dos funcionários para cada departamento.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que usa CTEs para organizar a consulta principal</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">WITH</span> <span class="n">department_employees</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">department_id</span><span class="p">,</span>
        <span class="k">SUM</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_salary</span>
    <span class="k">FROM</span> <span class="n">employees</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">department_id</span>
<span class="p">),</span>
<span class="n">department_projects</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
        <span class="k">SUM</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">prj</span><span class="p">.</span><span class="n">budget</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_project_budget</span>
    <span class="k">FROM</span> <span class="n">projects</span> <span class="n">prj</span>
    <span class="k">JOIN</span> <span class="n">employee_projects</span> <span class="n">emp_prj</span> <span class="k">ON</span> <span class="n">prj</span><span class="p">.</span><span class="n">project_id</span> <span class="o">=</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">project_id</span>
    <span class="k">JOIN</span> <span class="n">employees</span> <span class="n">emp</span> <span class="k">ON</span> <span class="n">emp_prj</span><span class="p">.</span><span class="n">employee_id</span> <span class="o">=</span> <span class="n">emp</span><span class="p">.</span><span class="n">employee_id</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span>
<span class="p">)</span>
<span class="k">SELECT</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span><span class="p">,</span>
    <span class="n">dep</span><span class="p">.</span><span class="n">budget</span><span class="p">,</span>
    <span class="n">COALESCE</span><span class="p">(</span><span class="n">dp</span><span class="p">.</span><span class="n">total_project_budget</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">project_budget</span><span class="p">,</span>
    <span class="n">COALESCE</span><span class="p">(</span><span class="n">de</span><span class="p">.</span><span class="n">total_salary</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">employee_salaries</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="n">dep</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">department_employees</span> <span class="n">de</span> <span class="k">ON</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">de</span><span class="p">.</span><span class="n">department_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">department_projects</span> <span class="n">dp</span> <span class="k">ON</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dp</span><span class="p">.</span><span class="n">department_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_name</span> <span class="k">ASC</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Essa consulta usa duas CTEs: <code>department_employees</code> e <code>department_projects</code>, que calculam o total de salários dos funcionários e o orçamento dos projetos para cada departamento, respectivamente. A consulta principal então junta essas CTEs com a tabela <code>departments</code> para obter os resultados finais. Usar CTEs pode tornar consultas complexas mais fáceis de entender e manter, além de permitir a reutilização de consultas temporárias dentro da consulta principal.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_como-inserir-dados">Como inserir dados?</h3>
<div class="paragraph">
<p>Agora que sabemos como consultar dados, precisamos saber como inserir novos dados na base. Para isso usamos o comando <code>INSERT INTO</code>, que permite adicionar novas linhas a uma tabela existente.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que insere um novo departamento na tabela <code>departments</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">departments</span> <span class="p">(</span><span class="n">department_name</span><span class="p">,</span> <span class="k">location</span><span class="p">,</span> <span class="n">budget</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Research &amp; Development'</span><span class="p">,</span> <span class="s1">'Austin'</span><span class="p">,</span> <span class="mi">950000</span><span class="p">.</span><span class="mi">00</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Essa consulta insere um novo departamento chamado "Research &amp; Development" localizado em "Austin" com um orçamento de 950.000,00 na tabela <code>departments</code>. É importante garantir que os valores inseridos estejam de acordo com as restrições definidas na tabela, como tipos de dados e chaves primárias.</p>
</div>
<div class="paragraph">
<p>Uma insersão sempre terá o formato <code>INSERT INTO &lt;tabela&gt; (&lt;atributos&gt;) VALUES (&lt;valores&gt;)</code>, onde <strong>tabela</strong> é a tabela onde os dados serão inseridos, <strong>atributos</strong> é o conjunto de colunas que receberão os valores e <strong>valores</strong> é o conjunto de valores a serem inseridos.</p>
</div>
<div class="paragraph">
<p>Os valores inseridos podem ser constantes, como no exemplo acima, ou podem ser o resultado de uma consulta. Nesse caso, a consulta deve retornar um conjunto de resultados que corresponde ao número e tipo de atributos especificados na cláusula <code>INSERT INTO</code>.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que insere novos funcionários na tabela <code>employees</code> a partir de uma consulta</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">employees</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">hire_date</span><span class="p">,</span> <span class="n">job_title</span><span class="p">,</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">salary</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">hire_date</span><span class="p">,</span> <span class="n">job_title</span><span class="p">,</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">salary</span>
<span class="k">FROM</span> <span class="n">temp_employees</span>
<span class="k">WHERE</span> <span class="n">hire_date</span> <span class="o">&gt;=</span> <span class="s1">'2025-01-01'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_como-atualizar-dados">Como atualizar dados?</h3>
<div class="paragraph">
<p>Para atualizar dados existentes em uma tabela, usamos o comando <code>UPDATE</code>, que permite modificar os valores de uma ou mais colunas para linhas que satisfazem uma determinada condição. O comando <code>UPDATE</code> é estruturado da seguinte forma: <code>UPDATE &lt;tabela&gt; SET &lt;atributo&gt;=&lt;valor&gt; WHERE &lt;condição&gt;</code>.</p>
</div>
<div class="paragraph">
<p>É sempre importante usar a cláusula <code>WHERE</code> para evitar atualizar todas as linhas da tabela, a menos que essa seja a intenção.</p>
</div>
<div class="listingblock">
<div class="title">Consulta que atualiza o orçamento de um departamento na tabela <code>departments</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Aumenta o salário dos funcionários do departamento 1 em 10%</span>
<span class="k">UPDATE</span> <span class="n">employees</span>
<span class="k">SET</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">salary</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">10</span>
<span class="k">WHERE</span> <span class="n">department_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">-- Atualiza o orçamento dos departamentos com base no total de</span>
<span class="c1">-- salários dos funcionários usando um overhead de 20%</span>
<span class="k">UPDATE</span> <span class="n">departments</span> <span class="n">dep</span>
<span class="k">SET</span> <span class="n">budget</span> <span class="o">=</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">20</span>  <span class="c1">-- 20% overhead</span>
    <span class="k">FROM</span> <span class="n">employees</span> <span class="n">emp</span>
    <span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">department_id</span> <span class="o">=</span> <span class="n">dep</span><span class="p">.</span><span class="n">department_id</span>
<span class="p">)</span>
<span class="k">WHERE</span> <span class="n">budget</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agora sabemos fazer operações básicas de consulta, inserção e atualização de dados em uma base de dados SQL. Também aprendemos sobre junções, agregações, subconsultas e CTEs, que são ferramentas poderosas para trabalhar com dados relacionais. Esse conhecimento é essencial para qualquer desenvolvedor que trabalhe com bancos de dados relacionais e nos prepara para explorar funcionalidades mais avançadas do SQL em futuras imersões.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="SQL" /><category term="PostgreSQL" /><category term="Consultas SQL" /><category term="Banco de Dados Relacional" /><category term="Modelagem de Dados" /><category term="Backend" /><summary type="html"><![CDATA[Dê vida aos seus dados com SQL! Neste tutorial imersivo, você aprenderá a construir consultas eficientes, explorar junções complexas, aplicar funções de agregação e organizar seu código com CTEs e subconsultas — tudo isso usando um modelo realista de banco de dados corporativo. Ideal para desenvolvedores, analistas e estudantes que desejam dominar a linguagem SQL além do básico e escrever queries poderosas e otimizadas.]]></summary></entry><entry><title type="html">Dicas para quem está iniciando na programação</title><link href="https://blog.vepo.dev/posts/dicas-para-quem-esta-iniciando-na-programacao" rel="alternate" type="text/html" title="Dicas para quem está iniciando na programação" /><published>2026-01-21T00:00:00+00:00</published><updated>2026-01-21T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/18-44-00-dicas-para-quem-esta-iniciando-na-programacao</id><content type="html" xml:base="https://blog.vepo.dev/posts/dicas-para-quem-esta-iniciando-na-programacao"><![CDATA[<p>Desde que comecei o meu canal recebo constantemente uma pergunta semelhate: <em>estou iniciando na programação e preciso de dicas, pode me dar algumas?</em> Vou tentar esboçar aqui alguns conselhos que podem te ajudar. A grande maioria delas sugirá da experiência de ver <strong>incautos</strong> reclamando nas redes sociais.</p>

<p><a href="https://www.dicio.com.br/incautos/"><img src="/assets/images/incauto.png" alt="Significado da palavra incauto no dicionário. As palavras &quot;desprevenido e ingênuo&quot; estão marcadas em vermelho" /></a></p>

<h2 id="1-entenda-o-que-é-programar">1. Entenda o que é programar</h2>

<p>Já perdi a conta das vezes que vi pessoas reclamando que o computador não faz aquilo que está programado, ou que “mágicas” acontece. Isso pode até parecer uma mera ingenuidade ou piada, mas vou levar com seriedade para me dar argumento de definir o que é programar.</p>

<p>Programar é definir o passo a passo que um programa deve fazer. Você é quem tem o total controle de tudo que está acontecendo no seu programa. Mas ele pode reagir a condições ou limitações externas. Se algo aconteceu de inesperado, ou você não “programou” ele direito ou algo de “inesperado” para você aconteceu. Lidar com o inesperado é uma habilidade que aprendemos com o tempo, aprendemos a isolar o inesperado para identificar e controlar ele.</p>

<p>Nós, como programadores, temos que ter ciência do que está acontecendo, entender e prever possíveis erros. E quando erros acontecerem precisamos identificar, corrigir os efeitos do erro e atualizar o código para que o erro não aconteça mais.</p>

<h2 id="2-entenda-como-o-seu-código-é-executado">2. Entenda como o seu código é executado</h2>

<p>Esse é uma dica que vai economizar muito do seu tempo. Erros acontecem e as vezes os erros acontecem porque seu código não foi executado corretamente, ou você está olhando para a execução de uma versão antiga dela.</p>

<p>É bom sempre entender como seu código é executado. Quais são os passos para transformar aquele arquivo texto em algo que o computador entenda. Computador não entende seu código, ele só entende a linguagem de máquina e é impraticável vocês escrever programas complexos em linguagem de máquina. Por isso muitas pessoas preferem aprender a programar em linguagens de script, ou seja, linguagens que são executadas diretamente do código como python e javascript.</p>

<p>Linguagens como o Java ou C precisam ser compiladas e depois executadas. É um passo um pouco dolorido para quem está aprendendo, mas é recompensador você entender o processo completo. A minha dica é que você faça apenas uma vez e depois escreva um script, quem sabe usando <code class="language-plaintext highlighter-rouge">bash</code> ou o similar do Windows, para repetir esses passos automáticamente.</p>

<p>Você também pode procurar alguma ferramenta que transforme a linguagem que você está estudando em script. No Java, por exemplo, existe o <a href="https://www.jbang.dev/">JBang</a>. Ou quem sabe algum site que facilita a sua vida criando ferramentas fáceis de executar o código, em uma busca rápida encontrei o <a href="https://www.onlinegdb.com/online_c_compiler">onlinegdb.com</a> para C e sei do <a href="https://exercism.org/">exercism</a> que dá suporte a sua linguagem.</p>

<p>Facilite a sua vida e foque no que é pioritário, tente automatizar tudo que é secundário.</p>

<h2 id="3-busque-nas-redes-sociais-as-comunidades-da-sua-linguagem">3. Busque nas redes sociais as comunidades da sua linguagem</h2>

<p>Minha próxima dica é construir uma “timeline” na sua rede <em>anti</em>-social preferida de pessoas que falam sobre o tema e dão dicas sobre o tema. Procure focar naqueles que realmente dão boas dicas e não naqueles que ficam fazendo piadas o tempo inteiro depreciando a imagem dos outros e das outras linguagens.</p>

<p>Como exemplo, fiz o exercicio de procurar a comunidade da linguagem C no Brasil. Procurei no Google “comunidade c lang brasil” e achei a página <a href="https://ccppbrasil.github.io/">C &amp; C++ Brasil</a>. Lá tem uma série de blogs que podem ser uma boa ajuda, já procura os autores nas redes sociais e segue eles.</p>

<p>Se alguma dúvida surgir, pergunta pra eles nas redes sociais.</p>

<p>NOTE: Não siga babaca! Se você viu a pessoa sendo babaca com qualquer pessoa, unfollow é liberdade.</p>

<h2 id="4-procure-uma-boa-ide">4. Procure uma boa IDE</h2>

<p>Eu tenho mais de 20 anos programado Java e não sou ninguém sem uma boa IDE. Não vou dizer que eu não conseguiria escrever um programa sem meu VSCode, IntelliJ ou o Eclipse. Conseguiria. Mas eu não conheço todos os métodos da classe <a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html">String</a> decorado e nem tenho acesso fácil a documentação. Para colocar a referência a classe eu procurei no Google e muito dos métodos que eu sei de cabeça existem desde o Java 4 (está na 25 hoje), tenho uma dificuldade enorme para achar os métodos adicionados nos últimos 10 anos. Logo a IDE é sua melhor amiga!</p>

<p>IDEs são Integrated Development Environment, ou Ambiente de Desenvolvimento Integrado. As pessoas não usam o Word ou o Notepad pra desenvolver, nem o Notepad++. Usam uma IDE e uma IDE com plugins que dão suporte a sua linguagem. Está com uma variável e não conhece a documentação do tiop dela? <code class="language-plaintext highlighter-rouge">CTRL+SPACE</code> e a lista de métodos que você pode chamar está na mão, isso é o que se chama Code Completion e é infinitamente melhor do que qualquer LLM da vida porque ela vai te dar possibilidades e documentação.</p>

<p>Com a IDE é possível também rodar seu código, de forma fácil. As vezes só aperta no play ▶️ e 💡! Isso também cobre o que falei na dica 2.</p>

<h2 id="5-entenda-a-estrutura-básica-da-linguagem">5. Entenda a estrutura básica da linguagem</h2>

<p>Você tem que entender 2 coisas básicas sobre a linguagem que você está aprendendo.</p>

<ol>
  <li>Qual o paradigma dela?</li>
  <li>Quais as estruturas sintaticas dela?</li>
</ol>

<p>A resposta da primeira pergunta vai te levar em um mundo de possibilidades que definirão a forma que você vai desenvolver. Saber que Java é uma linguagem Orientada a Objetos ou que Elixir é uma linguagem funcional, vai dar uma luz na hora de pensar o que você pode fazer.</p>

<p>Já a segunda pergunta vai te dar uma resposta bem óbvia. Joga “<linguagem> syntax" no Google e veja o resultado. Fiz o experimento e aqui estão as duas primeiras resposta em ordem:</linguagem></p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Java syntax</code>
    <ol>
      <li><a href="https://www.w3schools.com/java/java_syntax.asp">W3 Schools: Java Syntax</a> ← LEIA ESSE!!!!</li>
      <li><a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-18.html">Especificação do Java Chapter 18. Syntax</a> ← Se quiser ir a fundo, depois de 10 anos de experiência, leia esse.</li>
    </ol>
  </li>
  <li><code class="language-plaintext highlighter-rouge">golang syntax</code>
    <ol>
      <li><a href="https://www.w3schools.com/go/go_syntax.php">W3 Schools: Go Syntax</a> ← LEIA ESSE!!!!</li>
      <li><a href="https://go.dev/ref/spec">Especificação do GO</a> ← Se quiser ir a fundo, depois de 10 anos de experiência, leia esse.</li>
    </ol>
  </li>
</ol>

<p>De posse de um tutorial sobre a sintaxe, vá experimentado a linguagem, tentando entender cada passo.</p>

<h2 id="6-faça-exemplos-simples">6. Faça exemplos simples</h2>

<p>Existem inúmeros sites com exemplos que podem te ensinar a programar. Abra o <a href="https://exercism.org/">exercism</a>, <a href="https://www.codewars.com/">codewars.com</a> ou <a href="https://www.hackerrank.com/">hackerrank.com</a> e vai aprendendo. Não tente fazer um servidor web de inicio, isso só vai fazer você desistir.</p>

<p>Vá no exemplo simples. Comece com o programa que pergunta a sua idade e imprime com uma mensagem bonita. Depois escreva um programa que pergunta um número e imprime o valor do fatorial dele, ou imprime número na sequência fibonacci na posição do número. Depois faça um programa que lê um arquivo e verifica se os <code class="language-plaintext highlighter-rouge">(</code>, <code class="language-plaintext highlighter-rouge">[</code> e <code class="language-plaintext highlighter-rouge">{</code> estão corretamente definidos.</p>

<p>Evite usar a biblioteca da linguagem a principio, vá implementando na mão cada passo. Programar é aprender e aprender envolve desafio. Sem desafio você não vai muito longe não, vai estagnar.</p>

<h2 id="7-livros-é-bom">7. Livros é bom?</h2>

<p>Livros são excelentes, mas é preciso ter calma para escolher um livro bom. Em muitos casos os livros são verborrágicos e estão bem ultrapassados. Evite comprar livros muito caros a principio, a não ser que alguém de confiança tenha te indicado.</p>

<p>Prefira baixar o livro, quem sabe você não encontra ele por aí.</p>

<h2 id="8-curso-é-bom">8. Curso é bom?</h2>

<p>Também vá com calma! Escolha bem o curso antes de comprar. Existe muito picareta no mercado. Escolha muito bem o curso e a dica que eu te dou é evitar promessas miraculosas e escolher aquele que dá um bom acompanhamento. Se o material do curso só for liberado depois do sétimo dia, cancela!!!! Isso acontece porque não existe material, o vendendor do curso está esperando vencer o prazo de cancelamento do curso para te mostrar que você foi engando.</p>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Como aprender a programar" /><category term="Dicas para iniciantes" /><category term="Java" /><category term="Comunidade" /><summary type="html"><![CDATA[Um guia prático com dicas essenciais para quem está começando na programação, desde entender o que é programar até escolher a IDE certa e evitar armadilhas comuns. Baseado em anos de experiência e observações de iniciantes nas redes sociais.]]></summary></entry><entry><title type="html">Habilitando HTTPS com Let’s Encrypt!</title><link href="https://blog.vepo.dev/posts/usando-https-com-lets-encrypt" rel="alternate" type="text/html" title="Habilitando HTTPS com Let’s Encrypt!" /><published>2026-01-07T00:00:00+00:00</published><updated>2026-01-07T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/09-04-00-usando-https-com-lets-encrypt</id><content type="html" xml:base="https://blog.vepo.dev/posts/usando-https-com-lets-encrypt"><![CDATA[<div class="paragraph">
<p>Se você tem uma aplicação web rodando em qualquer framework — como Quarkus, Spring Boot ou outro — e quer proteger sua comunicação usando HTTPS, este tutorial é para você.</p>
</div>
<div class="paragraph">
<p>Aqui, vamos configurar o NGINX como um <strong>servidor proxy reverso</strong>, responsável por gerenciar as conexões seguras (TLS/SSL) com os certificados gratuitos da <strong>Let&#8217;s Encrypt</strong>. Sua aplicação continuará rodando normalmente, enquanto o NGINX cuida da criptografia, liberando você para focar no código.</p>
</div>
<div class="paragraph">
<p>A ideia é simples: configuramos um domínio apontando para o nosso servidor, obtemos um certificado digital que valida a propriedade desse domínio e, por fim, ajustamos o NGINX para redirecionar o tráfego criptografado para a sua aplicação, independentemente da tecnologia que você usa.</p>
</div>
<div class="paragraph">
<p>Vamos começar?</p>
</div>
<div class="sect1">
<h2 id="_porque-usar-https">Porque usar HTTPS?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O HTTPS nada mais é que o protocolo HTTP protegido por uma camada de TLS.</p>
</div>
<div class="paragraph">
<p>É importante destacar que não se trata de um protocolo completamente novo — do ponto de vista do servidor da aplicação, a comunicação continua sendo HTTP.</p>
</div>
<div class="paragraph">
<p>A diferença está na conexão entre cliente e servidor, que agora passa por uma etapa adicional de segurança antes de transmitir os dados, conforme ilustrado no diagrama abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/http/https-osi.png" alt="https osi">
</div>
<div class="title">Figura 1. HTTP, HTTPS e o Modelo OSI como comparação</div>
</div>
<div class="paragraph">
<p>Nosso servidor web continua funcionando exatamente como antes. A diferença é que, com o HTTPS, ele pode ser acessado por meio de um <strong>gateway</strong> HTTP — como o NGINX — que fica entre o cliente e a aplicação.</p>
</div>
<div class="paragraph">
<p>O fluxo funciona assim:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>O cliente se conecta na porta 443 (HTTPS padrão).</p>
</li>
<li>
<p>O gateway recebe a requisição criptografada, descriptografa-a e a converte em uma requisição HTTP comum.</p>
</li>
<li>
<p>Em seguida, ele a encaminha ao servidor da aplicação, que responde como de costume.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Além disso, esse mesmo gateway pode ser configurado para redirecionar automaticamente qualquer tentativa de acesso pela porta 80 (HTTP) para a porta 443 (HTTPS), garantindo que toda a comunicação aconteça de forma segura.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/http/arquitetura-http-https.png" alt="arquitetura http https">
</div>
<div class="title">Figura 2. Arquitetura de uma comunicação Cliente-Servidor que tenta primeiro acessar a porta 80 mas é redirecionado para 443.</div>
</div>
<div class="paragraph">
<p>A imagem acima ilustra exatamente como nossa arquitetura pode ser implementada usando apenas uma máquina e o Docker, unindo todos os componentes que acabamos de descrever.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_porque-lets-encrypt">Porque Let&#8217;s Encrypt?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Talvez você esteja se perguntando: por que precisamos de algo além do nosso servidor HTTP para usar HTTPS?</p>
</div>
<div class="paragraph">
<p>A resposta está no <strong>TLS</strong> — a camada de segurança que torna o HTTP seguro. Vamos entender como essa comunicação funciona e como ela protege seus dados.</p>
</div>
<div class="paragraph">
<p>O TLS protege a comunicação entre cliente e servidor com dois objetivos principais:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Autenticar o servidor, garantindo que você está se conectando ao destino verdadeiro — por exemplo, ao acessar blog.vepo.dev, ter certeza de que é realmente o meu blog, e não um site impostor.</p>
</li>
<li>
<p>Criptografar os dados trocados, assegurando que apenas você e o servidor possam ler o conteúdo da comunicação.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para isso, o TLS usa <strong>criptografia assimétrica</strong> durante a fase inicial da conexão, permitindo que cliente e servidor estabeleçam uma chave secreta de forma segura — mesmo em um canal potencialmente inseguro como a internet.</p>
</div>
<div class="paragraph">
<p>A criptografia assimétrica usa um par de chaves: a <strong>chave privada</strong> (que é secreta) e a <strong>chave pública</strong> (que pode ser distribuída).
Uma mensagem criptografada com a chave privada só pode ser descriptografada usando a chave pública correspondente. Como apenas o dono da chave privada poderia ter criado essa mensagem, ela funciona como uma assinatura digital, provando a identidade de quem a enviou.</p>
</div>
<div class="paragraph">
<p>Na prática, quando seu navegador se conecta a um servidor HTTPS, ele verifica o certificado digital apresentado — que contém a chave pública do site e é assinado por uma autoridade confiável. Isso permite confirmar que você está realmente se comunicando com o domínio correto, e não com um impostor.</p>
</div>
<div class="paragraph">
<p>No entanto, para serviços simples, sem muito riscos, alguns optam por usar certificados autoassinados. Eles ainda criptografam o tráfego, impedindo que ferramentas como o <a href="https://www.wireshark.org">Wireshark</a> leiam os dados da comunicação, mas não fornecem autenticação confiável para o público geral, já que não são validados por uma autoridade externa.</p>
</div>
<div class="paragraph">
<p>É aí que entra o <strong>Let&#8217;s Encrypt</strong>!</p>
</div>
<div class="paragraph">
<p>Esse serviço automatiza a criação e a validação de certificados TLS. Ele gera o par de chaves pública e privada para você e, para confirmar que você realmente controla o domínio, realiza uma verificação simples — normalmente via DNS ou por meio de um arquivo temporário no seu servidor.</p>
</div>
<div class="paragraph">
<p>Uma vez aprovado, o Let&#8217;s Encrypt assina seu certificado digital, permitindo que qualquer navegador reconheça seu site como seguro — tudo de forma gratuita e automatizada.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1-configurando-o-ambiente">1. Configurando o ambiente</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Antes de começar, vamos preparar o ambiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Uma máquina com IP fixo
Você pode provisioná-la em qualquer provedor de nuvem (Magalu Cloud, AWS, DigitalOcean, Google Cloud, etc.) ou usar um servidor próprio.</p>
</li>
<li>
<p>Linux com Docker instalado
É o único requisito de software — garantindo que possamos rodar os contêineres de forma isolada e reproduzível.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2-criando-o-serviço-nginx">2. Criando o serviço NGINX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Com isso pronto, criaremos um arquivo chamado <code>docker-compose.yml</code>. Ele define toda a configuração dos nossos serviços em código, tornando a implantação consistente e fácil de gerenciar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.29-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/nginx:/etc/nginx/conf.d</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Com o <code>docker-compose.yml</code> acima configurado, o NGINX já estará escutando nas portas 80 (HTTP) e 443 (HTTPS) da sua máquina. Isso significa que você pode apontar seu domínio no DNS para o IP fixo do servidor.</p>
</div>
<div class="paragraph">
<p>Agora, precisamos definir o conteúdo do arquivo <code>./data/nginx/app.conf</code>. É nele que configuramos o comportamento do servidor — como redirecionamentos, regras de proxy e a associação do certificado SSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://example.org</span><span class="p">;</span> <span class="c1">#for demo purposes</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste arquivo, configuramos dois servidores virtuais no NGINX:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Um servidor HTTP comum, que escuta na porta 80.</p>
</li>
<li>
<p>Um servidor HTTPS, que escuta na porta 443 e usa SSL/TLS.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>No entanto, o servidor HTTPS ainda não funcionará, pois falta configurar corretamente os certificados SSL — etapa que faremos em seguida com a ajuda do Let&#8217;s Encrypt.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3-configurando-o-certbot-lets-encrypt">3. Configurando o CertBot Let&#8217;s Encrypt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O <strong>Let&#8217;s Encrypt</strong> valida o domínio por meio de um desafio HTTP: ele tenta acessar uma URL específica no seu domínio e espera uma resposta conhecida. Se o servidor responder corretamente, fica provado que você controla o domínio — um mecanismo parecido com o usado pelo Google Search Console para verificar a propriedade de um site.</p>
</div>
<div class="paragraph">
<p>Para gerar e responder a esse desafio, usamos o Certbot. Por isso, precisamos configurar o contêiner do NGINX para servir os arquivos temporários que o Certbot cria durante o processo de validação.</p>
</div>
<div class="paragraph">
<p>Primeiro, vamos ajustar o ambiente para incluir o Certbot. Para isso, precisamos:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declarar o serviço do Certbot no nosso <code>docker-compose.yml</code>.</p>
</li>
<li>
<p>Criar um volume compartilhado entre os containers do NGINX e do Certbot, permitindo que eles troquem os arquivos necessários para a validação do domínio.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>O arquivo <code>docker-compose.yml</code> atualizado é mostrado a seguir:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.29-alpine</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/nginx:/etc/nginx/conf.d</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>    <span class="c1">## Configurações geradas pelo CertBot</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>     <span class="c1">## Chaves geradas pelo CertBot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
  <span class="na">certbot</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">certbot/certbot</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora, precisamos configurar o servidor NGINX para responder ao desafio HTTP do <strong>Let&#8217;s Encrypt</strong>.</p>
</div>
<div class="paragraph">
<p>Ele espera que uma URL específica — <code>/.well-known/acme-challenge/</code> — esteja acessível via porta 80 (HTTP). Portanto, vamos direcionar todas as requisições para esse caminho a um local onde o Certbot possa fornecer a resposta correta.</p>
</div>
<div class="paragraph">
<p>Após o desafio ser resolvido com sucesso, o Certbot gerará automaticamente os certificados e chaves necessários para o TLS.</p>
</div>
<div class="paragraph">
<p>Eles serão armazenados nos seguintes caminhos dentro do container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certificado público (fullchain):
<code>/etc/letsencrypt/live/example.org/fullchain.pem</code></p>
</li>
<li>
<p>Chave privada (privkey):
<code>/etc/letsencrypt/live/example.org/privkey.pem</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Esses arquivos são essenciais para que o NGINX configure a conexão HTTPS corretamente. O CertBot também gera alguns arquivos de configuração que podem ser visto abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="n">/.well-known/acme-challenge/</span> <span class="p">{</span>  <span class="c1">## Define o desafio</span>
        <span class="kn">root</span> <span class="n">/var/www/certbot</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/example.org/fullchain.pem</span><span class="p">;</span>    <span class="c1">## Define a chave pública</span>
    <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/example.org/privkey.pem</span><span class="p">;</span>  <span class="c1">## Define a chave privada</span>

    <span class="kn">include</span> <span class="n">/etc/letsencrypt/options-ssl-nginx.conf</span><span class="p">;</span>   <span class="c1">## Configurações geradas pelo CertBot</span>
    <span class="kn">ssl_dhparam</span> <span class="n">/etc/letsencrypt/ssl-dhparams.pem</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://example.org</span><span class="p">;</span> <span class="c1">#for demo purposes</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4-inicializando-o-certbot">4. Inicializando o CertBot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Se você tentar subir o ambiente agora com <code>docker-compose up</code>, ele ainda não funcionará completamente. Isso porque os certificados SSL precisam ser solicitados e configurados pela primeira vez.</p>
</div>
<div class="paragraph">
<p>Para facilitar esse processo inicial, criamos um script de inicialização que automatiza todos os passos. Você só precisa executá-lo após atualizar o seu e-mail na linha onde está definido <code>email=""</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Baixa o script de inicialização oficial do repositório nginx-certbot</span>
curl <span class="nt">-L</span> https://raw.githubusercontent.com/wmnnd/nginx-certbot/master/init-letsencrypt.sh <span class="o">&gt;</span> init-letsencrypt.sh

<span class="c"># Abre o script no editor vi para personalização</span>
<span class="c"># IMPORTANTE: Atualize o e-mail na linha que contém 'email=""'</span>
vi init-letsencrypt.sh

<span class="c"># Torna o script executável (adiciona permissão de execução)</span>
<span class="nb">chmod</span> +x init-letsencrypt.sh

<span class="c"># Executa o script com privilégios de superusuário</span>
<span class="c"># O script irá configurar automaticamente os certificados SSL/TLS</span>
<span class="nb">sudo</span> ./init-letsencrypt.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Após executar o script, todos os arquivos de certificado e configuração necessários serão criados.</p>
</div>
<div class="paragraph">
<p>O próximo passo é reconfigurar o sistema para renovação automática: os certificados da Let&#8217;s Encrypt têm validade limitada, então precisamos garantir que sejam renovados automaticamente antes de expirar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.29-alpine</span>
    <span class="c1">## Força o NGINX atualizar a cada 6hs</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/bin/sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">6h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">nginx</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">reload;</span><span class="nv"> </span><span class="s">done</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">nginx</span><span class="nv"> </span><span class="s">-g</span><span class="nv"> </span><span class="se">\"</span><span class="s">daemon</span><span class="nv"> </span><span class="s">off;</span><span class="se">\"</span><span class="s">'"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/nginx:/etc/nginx/conf.d</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>    <span class="c1">## Configurações geradas pelo CertBot</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>     <span class="c1">## Chaves geradas pelo CertBot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
  <span class="na">certbot</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">certbot/certbot</span>
    <span class="c1">## Força o CertBot atualizar a cada 6hs</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/bin/sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'trap</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">TERM;</span><span class="nv"> </span><span class="s">while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">certbot</span><span class="nv"> </span><span class="s">renew;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">12h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">done;'"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5-configurando-o-banco-e-aplicação">5. Configurando o Banco e Aplicação</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para finalizar, vamos configurar o banco de dados e a aplicação. Como esses passos podem variar conforme o framework ou tecnologia utilizada, apresentaremos uma configuração genérica abaixo, que você poderá adaptar conforme sua necessidade.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">postgres</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:18-alpine</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app-postgres</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">app_db</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">app_user</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${POSTGRES_PASSWORD:-AppPassword1234}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/mnt/data/postgres:/var/lib/postgresql/18/docker</span>    <span class="c1">## Salva os dados em um Volume persistente</span>
      <span class="pi">-</span> <span class="s">./init.sql:/docker-entrypoint-initdb.d/init.sql</span>     <span class="c1">## Inicializa o banco</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5432:5432"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD-SHELL"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">app_user</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">app_db"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">5s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">postgres</span>
      <span class="s">-c log_statement=all</span>
      <span class="s">-c log_destination=stderr</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">my-user/my-app:main</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">app</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">postgres</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">QUARKUS_PROFILE</span><span class="pi">:</span> <span class="s">prod</span>
      <span class="na">QUARKUS_DATASOURCE_USERNAME</span><span class="pi">:</span> <span class="s">app_user</span>
      <span class="na">QUARKUS_DATASOURCE_PASSWORD</span><span class="pi">:</span> <span class="s">${POSTGRES_PASSWORD:-AppPassword1234}</span>
      <span class="na">QUARKUS_DATASOURCE_JDBC_URL</span><span class="pi">:</span> <span class="s">jdbc:postgresql://postgres:5432/app_db</span>
      <span class="na">QUARKUS_HIBERNATE_ORM_DATABASE_GENERATION</span><span class="pi">:</span> <span class="s">update</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:8080/q/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.29-alpine</span>
    <span class="c1">## Força o NGINX atualizar a cada 6hs</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/bin/sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">6h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">nginx</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">reload;</span><span class="nv"> </span><span class="s">done</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">nginx</span><span class="nv"> </span><span class="s">-g</span><span class="nv"> </span><span class="se">\"</span><span class="s">daemon</span><span class="nv"> </span><span class="s">off;</span><span class="se">\"</span><span class="s">'"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">443:443"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/nginx:/etc/nginx/conf.d</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>    <span class="c1">## Configurações geradas pelo CertBot</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>     <span class="c1">## Chaves geradas pelo CertBot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
  <span class="na">certbot</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">certbot/certbot</span>
    <span class="c1">## Força o CertBot atualizar a cada 6hs</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/bin/sh</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">'trap</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">TERM;</span><span class="nv"> </span><span class="s">while</span><span class="nv"> </span><span class="s">:;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">certbot</span><span class="nv"> </span><span class="s">renew;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">12h</span><span class="nv"> </span><span class="s">&amp;</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">$${!};</span><span class="nv"> </span><span class="s">done;'"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./data/certbot/conf:/etc/letsencrypt</span>
      <span class="pi">-</span> <span class="s">./data/certbot/www:/var/www/certbot</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app-network</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">app-network</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">bridge</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por fim, precisamos informar ao NGINX onde nossa aplicação está disponível.
Ela está rodando na porta 8080 e, dentro da rede Docker, pode ser acessada pelo nome do serviço: "app".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="nginx"><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">location</span> <span class="n">/.well-known/acme-challenge/</span> <span class="p">{</span>  <span class="c1">## Define o desafio</span>
        <span class="kn">root</span> <span class="n">/var/www/certbot</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">example.org</span><span class="p">;</span>

    <span class="kn">ssl_certificate</span> <span class="n">/etc/letsencrypt/live/example.org/fullchain.pem</span><span class="p">;</span>    <span class="c1">## Define a chave pública</span>
    <span class="kn">ssl_certificate_key</span> <span class="n">/etc/letsencrypt/live/example.org/privkey.pem</span><span class="p">;</span>  <span class="c1">## Define a chave privada</span>

    <span class="kn">include</span> <span class="n">/etc/letsencrypt/options-ssl-nginx.conf</span><span class="p">;</span>   <span class="c1">## Configurações geradas pelo CertBot</span>
    <span class="kn">ssl_dhparam</span> <span class="n">/etc/letsencrypt/ssl-dhparams.pem</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://app:8080</span><span class="p">;</span>    <span class="c1">## Aqui finalmente acessamos a aplicação</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Com essa configuração, sua aplicação — independentemente do framework utilizado — agora está acessível via HTTPS, com certificados válidos e renovação automática gerenciada pela Let&#8217;s Encrypt.</p>
</div>
<div class="paragraph">
<p>O NGINX atua como um gateway seguro, descriptografando o tráfego externo e redirecionando-o para sua app interna, enquanto o Docker mantém os serviços isolados e fáceis de atualizar.</p>
</div>
<div class="paragraph">
<p>Se tiver dúvidas ou sugestões, entra em contato comigo pelas redes sociais!</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="HTTPS" /><category term="HTTP" /><category term="Docker" /><category term="NGINX" /><category term="Let's Encrypt" /><category term="DevOps" /><summary type="html"><![CDATA[Nesse post vamos configurar HTTPS com certificados Let's Encrypt para qualquer aplicação web, usando NGINX como proxy reverso e Docker para um ambiente isolado e reproduzível.]]></summary></entry><entry><title type="html">Normalização de Dados</title><link href="https://blog.vepo.dev/posts/normalizacao-de-modelos-er" rel="alternate" type="text/html" title="Normalização de Dados" /><published>2026-01-05T00:00:00+00:00</published><updated>2026-01-05T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/12-24-00-normalizacao-mapeamento-er</id><content type="html" xml:base="https://blog.vepo.dev/posts/normalizacao-de-modelos-er"><![CDATA[<div class="paragraph">
<p>No post anterior, projetamos um modelo entidade-relacional (ER) para representar os dados de funcionários de uma empresa. Nele definimos quatro tabelas para representar as entidades <code>Funcionário</code>, <code>Endereço</code>, <code>Contato</code> e <code>Experiência Anterior</code>, além dos relacionamentos entre elas. Talvez vocë tenha se perguntado se o modelo não poderia ser feito de outra forma, ou mais simples ou, quem sabe, mais complexo. SIM! Modelagem de dados depende de muitos fatores e pode ser feita de várias formas diferentes, mas há algumas boas práticas que possuem implicações na quantidade e na qualidade dos dados armazenados. Para entender melhor essas boas práticas, vamos falar de normalização de dados.</p>
</div>
<div class="listingblock">
<div class="title">Script SQL para criação das tabelas do modelo entidade-relacional de funcionários</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_experiencias_anterior</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">empresa</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cargo</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">data_inicio</span>     <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">data_fim</span>        <span class="nb">DATE</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">nome</span>            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">sobrenome</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">CPF</span>             <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">data_nascimento</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">cargo</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>   <span class="c1">-- Cargo do funcionário</span>
    <span class="n">salario</span>         <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>  <span class="c1">-- Salário do funcionário</span>
    <span class="n">gestor_id</span>       <span class="nb">BIGINT</span><span class="p">,</span>         <span class="c1">-- Chave Estrangeira para tb_funcionarios (autorreferência)</span>
    <span class="n">gestao</span>          <span class="nb">BOOLEAN</span><span class="p">,</span>        <span class="c1">-- Indica se o funcionário está em uma posição de gestão</span>
    <span class="n">experiencia_anterior_id</span> <span class="nb">BIGINT</span><span class="p">,</span> <span class="c1">-- Chave Estrangeira para tb_funcionarios_experiencias_anterior</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">experiencia_anterior_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios_experiencias_anterior</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">gestor_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">experiencia_anterior_id</span><span class="p">)</span>  <span class="c1">-- Garante o relacionamento um-para-um</span>
<span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_enderecos</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">funcionario_id</span>  <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>       <span class="c1">-- Chave Estrangeira para tb_funcionarios</span>
    <span class="n">rua</span>             <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">cidade</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">estado</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cep</span>             <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">-- Chave Estrangeira</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_contatos</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">funcionario_id</span>  <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- Chave Estrangeira para tb_funcionarios</span>
    <span class="n">tipo</span>            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>     <span class="c1">-- Ex: 'telefone', 'email'</span>
    <span class="n">valor</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>    <span class="c1">-- Ex: número de telefone ou endereço de email</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">-- Chave Estrangeira</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_quais-problemas-a-normalização-de-dados-busca-resolver">Quais problemas a normalização de dados busca resolver?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para entender a importância da normalização de dados, precisamos primeiro entender alguns problemas comuns que podem ocorrer em bancos de dados mal projetados. Esses problemas incluem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Redundância de Dados</strong>: Quando os mesmos dados são armazenados em múltiplos lugares, o que pode levar a inconsistências e desperdício de espaço.</p>
</li>
<li>
<p><strong>Inconsistência de Dados</strong>: Quando diferentes versões dos mesmos dados existem em diferentes lugares, levando a confusão e erros.</p>
</li>
<li>
<p><strong>Dificuldade de Manutenção</strong>: Quando a estrutura do banco de dados é complexa demais, tornando difícil adicionar, atualizar ou excluir dados sem afetar outras partes do banco de dados.</p>
</li>
<li>
<p><strong>Complexidade nas Consultas</strong>: Quando a estrutura do banco de dados torna as consultas SQL mais complicadas do que o necessário, dificultando a recuperação eficiente dos dados.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sistemas computacionais precisam ser compreensíveis, fáceis de manter e eficientes. A normalização de dados é uma técnica que ajuda a alcançar esses objetivos. Se olharmos para o modelo ER que projetamos, podemos identificar algumas áreas onde a normalização pode ser aplicada para melhorar a estrutura do banco de dados.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Cargo do Funcionário</strong>: No modelo atual, o cargo do funcionário está armazenado na tabela <code>tb_funcionarios</code> e isso não garante que cargos iguais sejam representados de forma consistente. Se um cargo for atualizado, todas as ocorrências desse cargo precisam ser atualizadas manualmente, o que pode levar a inconsistências.</p>
</li>
<li>
<p><strong>Salário do Funcionário</strong>: Similar ao cargo, o salário do funcionário está armazenado diretamente na tabela <code>tb_funcionarios</code>. Se houver uma política de aumento salarial que afete múltiplos funcionários ou cargos, isso pode levar a redundância e inconsistência.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para resolver esses problemas, e tantos outros similares, precisamos identificar dentro do nosso modelo de dados quais são as informações redundantes e que possuem dependências funcionais. No caso acima, podemos identificar claramente que o cargo do funcionário e o salário possuem uma dependência funcional, ou seja, o salário depende do cargo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-é-dependência-funcional">O que é dependência funcional?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A dependência funcional é um conceito da álgebra relacional que descreve a relação entre subconjuntos de atributos de uma relação que podem ser determinados por outros atributos. Em termos simples, dizemos que um atributo B é funcionalmente dependente de um atributo A se, para cada valor de A, existe exatamente um valor correspondente de B. Por exemplo, em um banco de dados de funcionários, o salário pode ser funcionalmente dependente do cargo do funcionário e vice-versa.</p>
</div>
<div class="paragraph">
<p>Matematicamente, dizemos que <code>X → Y</code> (X determina Y) se, para cada valor de <code>X</code>, existe exatamente um valor correspondente de <code>Y</code>. No nosso exemplo, podemos dizer que <strong>Cargo → Salário</strong>.</p>
</div>
<div class="paragraph">
<p>Através da dependência funcional, podemos definir os conceitos de chave, superchave, atributo primo e atributo não-primo, que são fundamentais para a normalização de dados.</p>
</div>
<div class="sect2">
<h3 id="_o-que-é-uma-chave-em-um-banco-de-dados">O que é uma chave em um banco de dados?</h3>
<div class="paragraph">
<p>Uma chave é um conjunto de atributos que identifica unicamente uma tupla (linha) em uma relação (tabela). Para que o conjunto de atributos seja considerado uma chave, ele deve satisfazer duas propriedades principais:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Unicidade</strong>: Nenhuma duas tuplas na relação podem ter os mesmos valores para os atributos da chave.</p>
</li>
<li>
<p><strong>Minimalidade</strong>: Nenhum subconjunto dos atributos da chave pode satisfazer a propriedade de unicidade.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exemplo? Considere a tabela <code>tb_funcionarios</code> que possui os atributos <code>id</code>, <code>nome</code>, <code>sobrenome</code> e <code>CPF</code>. A chave primária poderia ser o atributo <code>id</code>, pois ele identifica unicamente cada funcionário na tabela. Outra possível chave seria o atributo <code>CPF</code>, que também é único para cada funcionário.</p>
</div>
<div class="paragraph">
<p>Já <code>nome</code> e <code>sobrenome</code> não podem ser considerados chaves, pois podem haver funcionários com o mesmo nome e sobrenome.</p>
</div>
</div>
<div class="sect2">
<h3 id="_o-que-é-uma-superchave">O que é uma superchave?</h3>
<div class="paragraph">
<p>Uma superchave é um subconjunto de atributos que identifica unicamente uma tupla em uma relação, mas pode conter atributos adicionais que não são necessários para a identificação única. Em outras palavras, uma superchave pode ser uma chave, mas também pode incluir atributos extras que não são essenciais para a unicidade.</p>
</div>
<div class="paragraph">
<p>Exemplo? Considere a tabela <code>tb_funcionarios</code> que possui os atributos <code>id</code>, <code>nome</code>, <code>sobrenome</code> e <code>CPF</code>. O atributo <code>CPF</code> é uma superchave, pois identifica unicamente cada funcionário na tabela. No entanto, o conjunto de atributos <code>{CPF, nome, sobrenome}</code> também é uma superchave, pois identifica unicamente cada funcionário na tabela, mesmo que <code>nome</code> e <code>sobrenome</code> não sejam necessários para essa identificação.</p>
</div>
<div class="paragraph">
<p>Todo atributo que compõe uma chave é chamado de <strong>atributo primo</strong>, enquanto os atributos que não fazem parte de nenhuma chave são chamados de <strong>atributos não-primos</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qual-é-a-relação-entre-normalização-e-dependência-funcional">Qual é a relação entre normalização e dependência funcional?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A normalização de dados é um processo que utiliza o conceito de dependência funcional para organizar os dados em um banco de dados de forma eficiente. O objetivo da normalização é eliminar a redundância e garantir a integridade dos dados, dividindo as tabelas em estruturas menores e mais gerenciáveis. Isso é feito através de várias formas normais (normal forms), cada uma com suas próprias regras e critérios baseados em dependências funcionais.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quais-são-as-formas-normais-existentes">Quais são as formas normais existentes?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As formas normais existentes são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Primeira Forma Normal</strong> (1NF): Garante que todos os atributos de uma tabela sejam atômicos, ou seja, indivisíveis. Isso significa que cada campo deve conter apenas um valor e não uma lista ou conjunto de valores. Naturalmente, todas as tabelas já estão na 1NF, exceto quando há problemas na modelagem.</p>
</li>
<li>
<p><strong>Segunda Forma Normal</strong> (2NF): Garante que todos os atributos não-chave sejam totalmente dependentes da chave primária. Isso significa que não deve haver dependências parciais, onde um atributo depende apenas de parte da chave primária.</p>
</li>
<li>
<p><strong>Terceira Forma Normal</strong> (3NF): Garante que todos os atributos não-chave sejam diretamente dependentes da chave primária e não de outros atributos não-chave. Isso elimina dependências transitivas.</p>
</li>
<li>
<p><strong>Forma Normal de Boyce-Codd</strong> (BCNF): Uma versão mais rigorosa da 3NF, onde todos os atributos dependem apenas da chave.</p>
</li>
<li>
<p><strong>Quarta Forma Normal</strong> (4NF): Garante que não haja dependências multivaloradas, onde um atributo pode ter múltiplos valores independentes de outro atributo.</p>
</li>
<li>
<p><strong>Quinta Forma Normal</strong> (5NF): Garante que todas as dependências de junção sejam eliminadas, o que significa que uma tabela não pode ser dividida em tabelas menores sem perder informações.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_como-violar-a-primeira-forma-normal-1nf">Como violar a Primeira Forma Normal (1NF)?</h3>
<div class="paragraph">
<p>Existem algumas formas de se violar a primeira forma normal.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Não é permitido usar a ordem das linhas para transmitir informações.</p>
</li>
<li>
<p>Não é permitido misturar tipos de dados na mesma coluna.</p>
</li>
<li>
<p>Não é permitido ter uma tabela sem chave primária.</p>
</li>
<li>
<p>Não é permitido repetir grupos.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para violar a 1NF, uma tabela deve conter atributos que não são atômicos</p>
</div>
<div class="listingblock">
<div class="title">A tabela abaixo viola a 1NF porque o atributo <code>telefone_1</code>, <code>telefone_2</code> e <code>telefone_3</code> formam um conjunto de valores não atômicos.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">sobrenome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cpf</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">telefone_1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
    <span class="n">telefone_2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
    <span class="n">telefone_3</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">A tabela abaixo viola a 1NF porque o atributo <code>telefones</code> não é atômico, ou seja, ele armazena múltiplos valores em um único campo.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">sobrenome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cpf</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
    <span class="n">telefone_1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
    <span class="n">telefone_2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
    <span class="n">telefone_3</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_como-violar-a-segunda-forma-normal-2nf">Como violar a Segunda Forma Normal (2NF)?</h3>
<div class="paragraph">
<p>Para violar a 2NF, uma tabela deve conter atributos não-chave que dependem apenas de parte da chave primária. Isso ocorre principalmente em tabelas com chaves compostas, onde alguns atributos podem ser determinados por apenas um dos componentes da chave.</p>
</div>
<div class="listingblock">
<div class="title">Violando a 2NF com dependências parciais</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_projetos</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">projeto_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">nome_funcionario</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>  <span class="c1">-- depende apenas de funcionario_id</span>
    <span class="n">nome_projeto</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>      <span class="c1">-- depende apenas de projeto_id</span>
    <span class="n">horas_trabalhadas</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">projeto_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste exemplo, temos dois problemas principais:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>nome_funcionario</code> depende apenas de <code>funcionario_id</code>, não da chave completa (<code>funcionario_id</code>, <code>projeto_id</code>)</p>
</li>
<li>
<p><code>nome_projeto</code> depende apenas de <code>projeto_id</code>, não da chave completa</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Essa estrutura viola a 2NF e pode causar anomalias:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Anomalia de atualização</strong>: Se um funcionário mudar de nome, precisamos atualizar múltiplas linhas.</p>
</li>
<li>
<p><strong>Anomalia de inserção</strong>: Não podemos inserir um novo projeto sem associá-lo a um funcionário.</p>
</li>
<li>
<p><strong>Anomalia de exclusão</strong>: Se excluirmos a última associação de um funcionário, perdemos seu nome.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Solução normalizada (2NF)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Tabela de funcionários</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Tabela de projetos</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_projetos</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Tabela de associação (relacionamento muitos-para-muitos)</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_projetos</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">projeto_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">tb_projetos</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">horas_trabalhadas</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">projeto_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora cada atributo não-chave depende da chave primária completa de sua tabela, eliminando as dependências parciais.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-violar-a-terceira-forma-normal-3nf">Como violar a Terceira Forma Normal (3NF)?</h3>
<div class="paragraph">
<p>Uma tabela viola a 3NF quando existem dependências transitivas: um atributo não-chave depende de outro atributo não-chave, e não diretamente da chave primária.</p>
</div>
<div class="listingblock">
<div class="title">Violando a 3NF com dependências transitivas</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span>          <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span>        <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cargo</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">salario</span>     <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>  <span class="c1">-- depende do cargo, não diretamente do id</span>
    <span class="n">gestao</span>      <span class="nb">BOOLEAN</span><span class="p">,</span>  <span class="c1">-- depende do cargo, não diretamente do id</span>
    <span class="n">nivel_cargo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>  <span class="c1">-- depende do cargo, não diretamente do id</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste exemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>salario</code>, <code>gestao</code> e <code>nivel_cargo</code> dependem de <code>cargo</code></p>
</li>
<li>
<p><code>cargo</code> depende de <code>id</code> (chave primária)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Portanto, temos uma cadeia de dependências: <code>id</code> → <code>cargo</code> → <code>{salario, gestao, nivel_cargo}</code></p>
</div>
<div class="paragraph">
<p>Isso cria dependências transitivas que podem causar problemas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Redundância</strong>: O mesmo salário é repetido para cada funcionário com o mesmo cargo.</p>
</li>
<li>
<p><strong>Inconsistência</strong>: Se atualizarmos o salário para um funcionário, precisamos lembrar de atualizar para todos.</p>
</li>
<li>
<p><strong>Complexidade</strong>: Alterações na política salarial exigem múltiplas atualizações.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Solução normalizada (3NF)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Tabela de cargos (nova entidade)</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_cargos</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">nivel</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">gestao</span> <span class="nb">BOOLEAN</span>
<span class="p">);</span>

<span class="c1">-- Tabela de funcionários com referência ao cargo</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">nome</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cargo_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">tb_cargos</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">salario</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora cada atributo não-chave depende diretamente da chave primária de sua tabela, eliminando as dependências transitivas.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-violar-a-forma-normal-de-boyce-codd-bcnf">Como violar a Forma Normal de Boyce-Codd (BCNF)?</h3>
<div class="paragraph">
<p>A BCNF é uma versão mais rigorosa da 3NF. Uma tabela viola a BCNF se existe uma dependência funcional onde o determinante não é uma superchave.</p>
</div>
<div class="listingblock">
<div class="title">Violando a BCNF com determinante não-superchave</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_formacoes</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">formacao</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">instrutor</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">formacao</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- Suposição: instrutor → formacao (cada instrutor leciona apenas uma formação)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aqui identificamos duas dependências funcionais:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>{funcionario_id, formacao}</code> → <code>instrutor</code> (da chave primária)</p>
</li>
<li>
<p><code>instrutor</code> → <code>formacao</code> (da suposição do negócio)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>O problema é que <code>instrutor</code> determina <code>formacao</code>, mas <code>instrutor</code> não é uma superchave (não identifica unicamente cada linha). Isso viola a BCNF.</p>
</div>
<div class="listingblock">
<div class="title">Solução normalizada (BCNF)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Tabela de instrutores e formações (um-para-um)</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_instrutores_formacoes</span> <span class="p">(</span>
    <span class="n">instrutor</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">formacao</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">UNIQUE</span>
<span class="p">);</span>

<span class="c1">-- Tabela de funcionários e formações</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_formacoes</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">formacao</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">formacao</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">formacao</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_instrutores_formacoes</span><span class="p">(</span><span class="n">formacao</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora, em cada tabela, todo determinante é uma superchave, satisfazendo a BCNF.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-violar-a-quarta-forma-normal-4nf">Como violar a Quarta Forma Normal (4NF)?</h3>
<div class="paragraph">
<p>A 4NF trata de dependências multivaloradas. Uma tabela viola a 4NF se contém pelo menos duas colunas multivaloradas independentes para a mesma chave.</p>
</div>
<div class="listingblock">
<div class="title">Violando a 4NF com dependências multivaloradas independentes</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_habilidades_idiomas</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">habilidade</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">idioma</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- Suposição: Habilidades e idiomas são independentes entre si</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste exemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Um funcionário pode ter múltiplas habilidades</p>
</li>
<li>
<p>Um funcionário pode falar múltiplos idiomas</p>
</li>
<li>
<p>Habilidades e idiomas são independentes (aprender uma habilidade não implica saber um idioma)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Isso gera <strong>combinações redundantes</strong>. Se Alice tem habilidades <code>{Java, SQL}</code> e idiomas <code>{Português, Inglês}</code>, a tabela terá 4 linhas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{Alice, Java, Português}</code></p>
</li>
<li>
<p><code>{Alice, Java, Inglês}</code></p>
</li>
<li>
<p><code>{Alice, SQL, Português}</code></p>
</li>
<li>
<p><code>{Alice, SQL, Inglês}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Essa redundância viola a 4NF.</p>
</div>
<div class="listingblock">
<div class="title">Solução normalizada (4NF)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Tabela para habilidades dos funcionários</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_habilidades</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">habilidade</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">habilidade</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Tabela para idiomas dos funcionários</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_idiomas</span> <span class="p">(</span>
    <span class="n">funcionario_id</span> <span class="nb">BIGINT</span><span class="p">,</span>
    <span class="n">idioma</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">,</span> <span class="n">idioma</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Agora cada multivalor está em sua própria tabela, eliminando as combinações redundantes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_como-violar-a-quinta-forma-normal-5nf">Como violar a Quinta Forma Normal (5NF)?</h3>
<div class="paragraph">
<p>A 5NF trata de <strong>dependências de junção</strong>. Uma tabela viola a 5NF quando pode ser decomposta em tabelas menores sem perder informação, mas essa decomposição revela restrições de negócio implícitas que não estão explicitamente modeladas.</p>
</div>
<div class="paragraph">
<p>Para entender melhor, considere o cenário de vendas onde:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Agentes vendem produtos</p>
</li>
<li>
<p>Produtos são vendidos para empresas</p>
</li>
<li>
<p>Agentes trabalham com empresas</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>O problema da violação da 5NF ocorre quando há uma regra de negócio oculta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Se um agente A vende um produto P, e o produto P é vendido para a empresa E, e o agente A trabalha com a empresa E, então necessariamente A vende P para E.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Violando potencialmente a 5NF com dependências de junção</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_vendas</span> <span class="p">(</span>
    <span class="n">agente</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">produto</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">empresa</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">agente</span><span class="p">,</span> <span class="n">produto</span><span class="p">,</span> <span class="n">empresa</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Suponha que sabemos separadamente que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alice vende Notebooks e Tablets;</p>
</li>
<li>
<p>Notebooks são vendidos para TechCorp e InovaTech;</p>
</li>
<li>
<p>Alice trabalha com TechCorp e InovaTech.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mas essa informação está descrita pelas linhas:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Agente</th>
<th class="tableblock halign-left valign-top">Produto</th>
<th class="tableblock halign-left valign-top">Empresa</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notebook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TechCorp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tablet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InovaTech</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notebook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InovaTech</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Se a regra de negócio mencionada for verdadeira, então Alice necessariamente vende Notebook para TechCorp (o que está na tabela), mas também deveria vender Notebook para InovaTech e Tablet para TechCorp, pois:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alice vende Notebook (fato 1)</p>
</li>
<li>
<p>Notebook é vendido para InovaTech (fato 2)</p>
</li>
<li>
<p>Alice trabalha com TechCorp (fato 3)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No entanto, esses registros não existem na tabela original. A tabela viola a 5NF porque não reflete completamente a dependência de junção implícita no negócio.</p>
</div>
<div class="paragraph">
<p>As anomalias causadas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inserção</strong>: Para adicionar que Alice vende Tablet, precisamos criar múltiplas combinações manualmente</p>
</li>
<li>
<p><strong>Consulta</strong>: Buscar todas as vendas possíveis requer verificar três tabelas diferentes</p>
</li>
<li>
<p><strong>Consistência</strong>: É possível ter dados inconsistentes (Alice vende Notebook, Notebook vai para InovaTech, mas não há registro dessa venda)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Solução normalizada (5NF)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Agentes e produtos que eles vendem</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_agentes_produtos</span> <span class="p">(</span>
    <span class="n">agente</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">produto</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">agente</span><span class="p">,</span> <span class="n">produto</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Produtos e empresas onde são vendidos</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_produtos_empresas</span> <span class="p">(</span>
    <span class="n">produto</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">empresa</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">produto</span><span class="p">,</span> <span class="n">empresa</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- Agentes e empresas com quem trabalham</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_agentes_empresas</span> <span class="p">(</span>
    <span class="n">agente</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">empresa</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">agente</span><span class="p">,</span> <span class="n">empresa</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Por que isso é melhor?</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Explicita as regras</strong>: Cada tabela captura uma relação de negócio específica;</p>
</li>
<li>
<p><strong>Evita redundância</strong>: Não armazena combinações deriváveis;</p>
</li>
<li>
<p><strong>Garante consistência</strong>: Se Alice vende Notebook e Notebook vai para TechCorp e Alice trabalha com TechCorp, então essa venda existe na junção;</p>
</li>
<li>
<p><strong>Facilita manutenção</strong>: Adicionar um novo produto para um agente automaticamente cria combinações com todas as empresas adequadas.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preciso-usar-todas-essa-formas-normais">Preciso usar todas essa formas normais?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Na prática, a maioria dos sistemas de banco de dados para na <strong>3NF</strong> ou <strong>BCNF</strong>. Essas formas eliminam as anomalias mais comuns de inserção, atualização e exclusão, mantendo um bom equilíbrio entre normalização e desempenho.</p>
</div>
<div class="paragraph">
<p>As formas normais mais altas (4NF e 5NF) são aplicadas apenas em casos específicos com estruturas de dados complexas. Vale lembrar que a desnormalização controlada é comum em data warehouses e sistemas analíticos para otimizar consultas complexas, mostrando que a normalização deve ser vista como uma ferramenta, não como um dogma.</p>
</div>
<div class="paragraph">
<p>A escolha do nível adequado de normalização depende do contexto: sistemas transacionais (OLTP) beneficiam-se de maior normalização, enquanto sistemas analíticos (OLAP) podem usar estruturas desnormalizadas para melhor desempenho.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Bases de Dados" /><category term="SQL" /><category term="Formas Normais" /><category term="Dependência Funcional" /><category term="Modelagem de Dados" /><summary type="html"><![CDATA[Neste post, aprofundamos os fundamentos da normalização de dados, explorando como organizar as tabelas de um banco de dados relacional para eliminar redundâncias, garantir integridade e facilitar a manutenção. Passaremos pelos conceitos essenciais de dependência funcional, chaves e superchaves, e percorreremos passo a passo as seis formas normais — da 1NF à 5NF — ilustrando com exemplos práticos de violação e correção baseados em um modelo de funcionários.]]></summary></entry><entry><title type="html">Mapeamento Entidade-Relacional para Modelo Relacional</title><link href="https://blog.vepo.dev/posts/mapeamento-entidade-relacional" rel="alternate" type="text/html" title="Mapeamento Entidade-Relacional para Modelo Relacional" /><published>2025-12-26T00:00:00+00:00</published><updated>2025-12-26T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/11-46-00-mapeamento-entidade-relacional</id><content type="html" xml:base="https://blog.vepo.dev/posts/mapeamento-entidade-relacional"><![CDATA[<div class="paragraph">
<p>Agora que entendemos os conceitos básicos de uma base de dados relacional e como ela é estruturada, vamos explorar como mapear um modelo entidade-relacional (ER) para uma aplicação. Nesse processo os dados representados no modelo ER são representados em tabelas relacionais que podem ser consultadas e manipuladas usando SQL.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Dica</div>
</td>
<td class="content">
Você pode encontrar os exemplos no repositório <a href="https://github.com/vepo/sql-database-tutorial">vepo/sql-database-tutorial</a>.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_o-que-são-entidades">O que são Entidades?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A base de um modelo relacional são as tabelas que armazenam entidades, objetos de valor e os relacionamentos entre eles. Para entender melhor como fazer esse mapeamento, vamos definir o que são esses conceitos.</p>
</div>
<div class="paragraph">
<p><em>*Uma Entidade é um objeto ou ente do mundo real que possui existência própria e cujas características ou propriedades desejamos armazenar.*</em> Uma entidade pode ser um ente físico (uma pessoa, um carro, um livro ou uma peça) ou um ente abstrato (um curso, um evento, uma conta bancária ou uma transação). O que define uma entidade é que sua existência é baseda em sua identidade única e não nos atributos que ela possui.</p>
</div>
<div class="paragraph">
<p>Por exemplo, vamos supor que temos um banco de dados para armazenar as informações de funcionários de uma grande empresa. Os campos que queremos armazenar são: nome, sobrenome, data de nascimento e cargo. É possível que existam dois funcionários com o mesmo nome, sobrenome e data de nascimento, mas eles sejam entidades diferentes? Sim, pois cada funcionário é uma pessoa no mundo real. Se depois de adicionado o funcionário desejarmos adicionar um novo campo para armazenar o número de CPF, isso diferenciará os dois funcionários.</p>
</div>
<div class="paragraph">
<p>Para exemplificar, vamos considerar uma tabela chamada <code>tb_funcionarios</code> que armazena as informações dos funcionários da empresa:</p>
</div>
<div class="listingblock">
<div class="title">Script para criação da tabela de Funcionários</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">nome</span>            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">sobrenome</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">data_nascimento</span> <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">cargo</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">salario</span>         <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nesse exemplo, a tabela <code>tb_funcionarios</code> representa a entidade "Funcionário". Cada linha na tabela corresponde a um funcionário específico, identificado de forma única pelo campo <code>id</code>, que é a chave primária da tabela. Os outros campos armazenam os atributos do funcionário, como nome, sobrenome, data de nascimento, cargo e salário.</p>
</div>
<div class="paragraph">
<p>Cada funcionário é considerada uma entidade distinta e única que pode ser identificada pelo seu <code>id</code>, independentemente dos outros atributos que possam ser iguais entre diferentes funcionários. A tabela <code>tb_funcionarios</code> que armazena as entidades, pode ser considerada um <em>conjunto de entidades</em>.</p>
</div>
<div class="paragraph">
<p><em>*Um Conjunto de Entidades é uma coleção de entidades do mesmo tipo que compartilham os mesmos atributos ou propriedades.*</em> Cada conjunto de entidades pode ser visto como um conjunto matemático no sentido que todos os seus elementos são distintos e não há uma ordem específica entre eles.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-são-objetos-de-valor-e-relacionamentos">O que são Objetos de Valor e Relacionamentos?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agora precisamos adicionar mais informações sobre os funcionários como o endereço e telefone. Essas informações não serão armazenadas na tabela <code>tb_funcionarios</code>, pois elas não definem a identidade do funcionário. Para isso, criaremos uma nova tabela chamada <code>tb_funcionarios_enderecos</code> e outra chamada <code>tb_funcionarios_contatos</code> para armazenar essas informações como objetos de valor relacionados à entidade funcionário.</p>
</div>
<div class="paragraph">
<p><em>*Um Objeto de Valor é um objeto que não possui identidade própria e sua existência é baseada em seus atributos.*</em> Diferente das entidades, os objetos de valor são definidos pelos atributos que possuem. Dois objetos de valor são considerados iguais se todos os seus atributos forem iguais, o que não significa que eles são a mesma linha em uma tabela relacional.</p>
</div>
<div class="paragraph">
<p>Vamos criar as tabelas <code>tb_funcionarios_enderecos</code> e <code>tb_funcionarios_contatos</code> para armazenar os endereços e contatos dos funcionários:</p>
</div>
<div class="listingblock">
<div class="title">Script para criação das tabelas de Endereços e Contatos</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_enderecos</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">funcionario_id</span>  <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>       <span class="c1">-- Chave Estrangeira para tb_funcionarios</span>
    <span class="n">rua</span>             <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
    <span class="n">cidade</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">estado</span>          <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cep</span>             <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">-- Chave Estrangeira</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_contatos</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">funcionario_id</span>  <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- Chave Estrangeira para tb_funcionarios</span>
    <span class="n">tipo</span>            <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>     <span class="c1">-- Ex: 'telefone', 'email'</span>
    <span class="n">valor</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>    <span class="c1">-- Ex: número de telefone ou endereço de email</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">funcionario_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">-- Chave Estrangeira</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Talvez você tenha notado que as tabelas <code>tb_funcionarios_enderecos</code> e <code>tb_funcionarios_contatos</code> possuem uma coluna chamada <code>funcionario_id</code>, que é uma chave estrangeira referenciando a tabela <code>tb_funcionarios</code>. Isso estabelece um relacionamento entre as tabelas, indicando que cada endereço e contato está associado a um funcionário específico.</p>
</div>
<div class="paragraph">
<p><em>*Um Relacionamento é uma associação entre uma ou mais tabelas que define como os dados se relacionam entre si.*</em> Relacionamentos são essenciais para manter a integridade dos dados e garantir que as informações estejam corretamente vinculadas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_como-podemos-classificar-os-tipos-de-relacionamentos">Como podemos classificar os tipos de Relacionamentos?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No nosso exemplo, o relacionamento entre as tabelas <code>tb_funcionarios</code>, <code>tb_funcionarios_enderecos</code> e <code>tb_funcionarios_contatos</code> é do tipo um-para-muitos (<em>one-to-many</em>). Isso significa que um funcionário pode ter múltiplos endereços e contatos, mas cada endereço ou contato está associado a apenas um funcionário.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/databases/er-funcionario-contatos-enderecos.png" alt="er funcionario contatos enderecos">
</div>
<div class="title">Figura 1. PlantUML Diagrama de Relacionamento entre Funcionários, Endereços e Contatos</div>
</div>
<div class="paragraph">
<p>Relacionamentos podem ser classificados em três tipos principais:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Um-para-um (one-to-one)</em>: Cada registro em uma tabela está associado a no máximo um registro em outra tabela.</p>
</li>
<li>
<p><em>Um-para-muitos (one-to-many)</em>: Um registro em uma tabela pode estar associado a múltiplos registros em outra tabela.</p>
</li>
<li>
<p><em>Muitos-para-muitos (many-to-many)</em>: Múltiplos registros em uma tabela podem estar associados a múltiplos registros em outra tabela. Esse tipo de relacionamento geralmente requer uma tabela intermediária para gerenciar as associações.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apesar dos tipos de relacionamentos serem importantes, eles não são diretamente definidos na linguagem SQL. Em vez disso, eles são definidos pela forma em que as chaves primárias e as estrangeiras são configuradas entre as tabelas.</p>
</div>
<div class="paragraph">
<p>Vamos imaginar agora que queremos armazenar a informação da profissional anterior dos funcionários em uma tabela chamada <code>tb_funcionarios_experiencias_anterior</code>, que terá um relacionamento um-para-um com a tabela <code>tb_funcionarios</code>. Cada funcionário terá apenas uma experiência profissional registrada. Para isso precisamos alterar a tabela <code>tb_funcionarios</code> e criar a nova tabela <code>tb_funcionarios_experiencias_anterior</code>:</p>
</div>
<div class="listingblock">
<div class="title">Script para criação da tabela de Experiências Profissionais</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios_experiencias_anterior</span> <span class="p">(</span>
    <span class="n">id</span>              <span class="n">BIGSERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- Chave Primária</span>
    <span class="n">empresa</span>         <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">cargo</span>           <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">data_inicio</span>     <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">data_fim</span>        <span class="nb">DATE</span>
<span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span>
<span class="k">ADD</span> <span class="n">experiencia_anterior_id</span> <span class="nb">BIGINT</span><span class="p">,</span> <span class="c1">-- Chave Estrangeira para tb_funcionarios_experiencias_anterior</span>
<span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">tb_funcionarios</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tb_funcionarios_experiencias_anterior</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="c1">-- Chave Estrangeira</span>
<span class="k">ADD</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">tb_funcionarios</span><span class="p">);</span> <span class="c1">-- Garante o relacionamento um-para-um</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nesse exemplo, a tabela <code>tb_funcionarios_experiencias_anterior</code> armazena as informações sobre as experiências profissionais dos funcionários. A tabela <code>tb_funcionarios</code> foi alterada para incluir uma coluna <code>experiencia_anterior_id</code>, que é uma chave estrangeira referenciando a tabela <code>tb_funcionarios_experiencias_anterior</code>. A restrição <code>UNIQUE</code> garante que cada funcionário possa ter no máximo uma experiência profissional associada, estabelecendo assim o relacionamento um-para-um.</p>
</div>
<div class="paragraph">
<p>Com essa estrutura, podemos ter a certeza que cada funcionário terá apenas uma experiência profissional registrada, e cada experiência profissional estará associada a apenas um funcionário.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-são-restrições-de-integridade-constraints">O que são Restrições de Integridade (<em>Constraints</em>)?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Não sei se você notou, mas no exemplo acima, utilizamos algumas restrições de integridade (<em>constraints</em>) para garantir a consistência dos dados no banco de dados relacional. As restrições de integridade são regras que definem como os dados podem ser inseridos, atualizados ou deletados em uma tabela. Elas ajudam a manter a integridade dos dados e evitam inconsistências.</p>
</div>
<div class="paragraph">
<p>Bases de dados relacionais permitem definir as restrições de integridade diretamente na definição das tabelas usando a linguagem SQL. Algumas das restrições mais comuns incluem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Chave Primária (PRIMARY KEY)</em>: Garante que cada registro em uma tabela seja único e não nulo. No exemplo, usamos a chave primária para identificar unicamente cada funcionário, endereço, contato e experiência profissional.</p>
</li>
<li>
<p><em>Chave Estrangeira (FOREIGN KEY)</em>: Garante que os valores em uma coluna correspondam aos valores em outra tabela, estabelecendo um relacionamento entre as tabelas. No exemplo, usamos chaves estrangeiras para associar endereços e contatos aos funcionários.</p>
</li>
<li>
<p><em>Único (UNIQUE)</em>: Garante que os valores em uma coluna sejam únicos. No exemplo, usamos a restrição <code>UNIQUE</code> para garantir que cada funcionário tenha no máximo uma experiência profissional associada.</p>
</li>
<li>
<p><em>Não Nulo (NOT NULL)</em>: Garante que uma coluna não possa conter valores nulos. Isso é útil para garantir que certos atributos essenciais estejam sempre presentes em um registro.</p>
</li>
<li>
<p><em>Verificação (CHECK)</em>: Permite definir uma condição que os valores em uma coluna devem satisfazer. Por exemplo, podemos usar uma restrição <code>CHECK</code> para garantir que a data de término de uma experiência profissional seja posterior à data de início.</p>
</li>
<li>
<p><em>Padrão (DEFAULT)</em>: Define um valor padrão para uma coluna quando nenhum valor é especificado durante a inserção de um registro.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Com as restrições de integridade, podemos garantir que os dados no banco de dados relacional estejam sempre consistentes e válidos, evitando problemas como duplicidade de registros, referências inválidas entre tabelas e valores nulos em campos essenciais.</p>
</div>
<div class="paragraph">
<p>E se no nosso exemplo quisermos garantir que o campo <code>cargo</code> na tabela <code>tb_funcionarios</code> não possa ser nulo? Podemos adicionar a restrição <code>NOT NULL</code> na definição da tabela:</p>
</div>
<div class="listingblock">
<div class="title">Script para criação da tabela de Funcionários com restrição NOT NULL</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tb_funcionarios</span>
<span class="k">MODIFY</span> <span class="n">cargo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span> <span class="c1">-- Adiciona a restrição NOT NULL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse exemplo não é completo, poderiamos também que os valores dos demais campos não fossem nulos, mas serve para ilustrar como as restrições de integridade podem ser aplicadas para garantir a consistência dos dados no banco de dados relacional.</p>
</div>
<div class="paragraph">
<p>Mas ainda falta um detalhe importante: e se nossa empresa for muito grande e quisermos encontrar facilmente um determinado funcionário pelo nome ou cargo? Para isso, podemos criar índices nas colunas <code>nome</code>, <code>sobrenome</code> e <code>cargo</code> da tabela <code>tb_funcionarios</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-são-índices-indexes">O que são Índices (<em>Indexes</em>)?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para entender como a consulta é realizada em uma base de dados, podemos pedir para a base explicar como ela pretende executar a consulta. Isso é possível utilizando o comando <code>EXPLAIN</code> antes da consulta SQL. Vamos imaginar que queremos encontrar todos os funcionários com o cargo de "Desenvolvedor". A consulta SQL seria a seguinte:</p>
</div>
<div class="listingblock">
<div class="title">Script para consulta de funcionários pelo cargo</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">tb_funcionarios</span> <span class="k">WHERE</span> <span class="n">cargo</span> <span class="o">=</span> <span class="s1">'Desenvolvedor'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A resposta do comando <code>EXPLAIN</code> nos mostrará o plano de execução que a base de dados pretende utilizar para realizar a consulta. Se não houver um índice na coluna <code>cargo</code>, a base de dados terá que fazer uma varredura completa na tabela <code>tb_funcionarios</code>, o que pode ser lento se a tabela tiver muitos registros.</p>
</div>
<div class="paragraph">
<p>Mas podemos melhorar o desempenho da consulta criando um índice na coluna <code>cargo</code>:</p>
</div>
<div class="listingblock">
<div class="title">Script para criação de índice na coluna cargo</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_funcionarios_cargo</span> <span class="k">ON</span> <span class="n">tb_funcionarios</span><span class="p">(</span><span class="n">cargo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Com o índice criado, a base de dados poderá utilizar o índice para localizar rapidamente os registros que correspondem ao cargo "Desenvolvedor", melhorando significativamente o desempenho da consulta.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neste post, exploramos como mapear um modelo entidade-relacional para um banco de dados relacional utilizando SQL. Vimos como definir entidades, objetos de valor e relacionamentos entre tabelas, além de aplicar restrições de integridade para garantir a consistência dos dados. Também discutimos a importância dos índices para melhorar o desempenho das consultas. Compreender esses conceitos é fundamental para projetar e implementar aplicações usando bases de dados relacionais de forma eficiente e eficaz.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Bases de Dados" /><category term="SQL" /><category term="Modelo Entidade-Relacional" /><category term="Modelagem de Dados" /><summary type="html"><![CDATA[Neste post, exploramos como mapear um modelo entidade-relacional para um banco de dados relacional utilizando SQL. Vemos como definir entidades, objetos de valor e relacionamentos entre tabelas, além de aplicar restrições de integridade para garantir a consistência dos dados. Também discutimos a importância dos índices para melhorar o desempenho das consultas.]]></summary></entry><entry><title type="html">Arquitetura de um Banco de Dados Relacional</title><link href="https://blog.vepo.dev/posts/arquitetura-dbms" rel="alternate" type="text/html" title="Arquitetura de um Banco de Dados Relacional" /><published>2025-12-22T00:00:00+00:00</published><updated>2025-12-22T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/12-17-00-arquitetura-dbms</id><content type="html" xml:base="https://blog.vepo.dev/posts/arquitetura-dbms"><![CDATA[<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Nota</div>
</td>
<td class="content">
Esse post é baseado em um capítulo do livro <a href="https://amzn.to/44Iatr3"><strong>Database Internals</strong> de Alex Petrov</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Agora que entendemos o que é uma base de dados relacional e como podemos interagir com ela usando SQL, vamos ver como uma base de dados relacional é construída internamente. Entender como umas base de dados funciona internamente pode nos ajudar a compreender melhor seu comportamento e com isso podemos tomar decisões mais informadas sobre o uso ou a escolha de uma base de dados.</p>
</div>
<div class="paragraph">
<p>Todas as implementações de bancos de dados são diferentes, mas a maioria delas compartilha de funcionalidades e arquiteturas semelhantes. No diagrama abaixo, temos uma visão geral de uma possível arquitetura de um sistema de gerenciamento de banco de dados relacional (DBMS - <strong>Database Management System</strong>), mas é importante lembrar que cada implementação pode variar em detalhes específicos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/databases/dmbs-arquitecture.png" alt="dmbs arquitecture">
</div>
<div class="title">Figura 1. Arquitetura de um Sistema de Gerenciamento de Banco de Dados Relacional (DBMS)</div>
</div>
<div class="paragraph">
<p>Para descrever essa arquitetura, vamos usar uma abordagem de cima para baixo, começando pelo módulo de transporte.</p>
</div>
<div class="sect1">
<h2 id="_módulo-de-transporte-transport">Módulo de Transporte (<em>Transport</em>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A grande maioria das bases de dados modernas são implementadas usando uma arquitetura cliente-servidor. Isso significa que a aplicação que utiliza o banco de dados atua como cliente, enquanto o processo do banco de dados atua como servidor.  Para isso o módulo de transporte é responsável por gerenciar a comunicação entre a aplicação cliente e, em caso de bancos distribuídos, entre as diferentes instâncias do banco de dados.</p>
</div>
<div class="paragraph">
<p>As <em>queries</em> SQL são então processadas pelo módulo <strong>Client Communication</strong>, que interpreta as requisições vindas do cliente e as encaminha para o próximo módulo, o <strong>Query Processor</strong>.</p>
</div>
<div class="paragraph">
<p>Quando a comunicação é feita entre diferentes instâncias do banco de dados, ela não envolve o processamento de consultas SQL e por isso é tratada diretamente pela <strong>Execution Engine</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo-de-processamento-de-consultas-query-processor">Módulo de Processamento de Consultas (<em>Query Processor</em>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O módulo de processamento de consultar é responsável por interpretar, validar e otimizar as consultas SQL recebidas do módulo de transporte. Ele é composto por dois submódulos principais: o <strong>Query Parser</strong> e o <strong>Query Optimizer</strong>. O submódulo <strong>Query Optimizer</strong> é responsável por analisar a consulta SQL e determinar a forma mais eficiente de executá-la, levando em consideração fatores como índices disponíveis, estatísticas de dados e custos de execução.</p>
</div>
<div class="paragraph">
<p>Um plano de execução é gerado baseado na <em>query</em> SQL recebida e é passado para o próximo módulo, a <strong>Execution Engine</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo-motor-de-execução-execution-engine">Módulo Motor de Execução (<em>Execution Engine</em>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para que o plano de execução gerado pelo módulo de processamento de consultas seja executado, ele pode ser executado localmente ou remotamente, se o banco de dados for distribuído. O módulo de execução é responsável por interpretar o plano de execução e coordenar as operações necessárias para recuperar ou modificar os dados conforme especificado na consulta SQL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_módulo-motor-de-armazenamento-storage-engine">Módulo Motor de Armazenamento (<em>Storage Engine</em>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O módulo motor de armazenamento é responsável por gerenciar a forma como os dados são armazenados fisicamente no disco. Ele é dividido em cinco submódulos principais: o <strong>Transaction Manager</strong>, o <strong>Lock Manager</strong>, o <strong>Access Methods</strong>, o <strong>Buffer Manager</strong> e o <strong>Recovery Manager</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/databases/storage-types.png" alt="storage types">
</div>
<div class="title">Figura 2. Tipos de armazenamentos possíveis para bases de dados</div>
</div>
<div class="paragraph">
<p>Um dos grandes desafios enfrentados pelas bases de dados é melhorar o desempenho do acesso ao disco. Todas as informações em um banco de dados são armazenadas em algum tipo de mídia não-volátil, mesmo que esteja em algum sistema de armazenamento em nuvem, e qualquer acesso a esses dados envolve operações de leitura e escrita que são muito mais lentas que as operações realizadas na memória volátil (RAM).</p>
</div>
<div class="paragraph">
<p>Outro desafio é que a leitura e escrita de dados no disco é feita em blocos de tamanho fixo, o que significa que mesmo que apenas um pequeno pedaço de informação seja necessário, o sistema precisa ler ou escrever o bloco inteiro. Esse comportamento é diferente do acesso à memória volátil, onde é possível acessar qualquer byte individualmente.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabela 1. Tempos médios de acesso para diferentes tipos de memória e armazenamento</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Tempo de Acesso</th>
<th class="tableblock halign-left valign-top">Tipo de Memória</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~1ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1 Cache Ref</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~4ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2 Cache Ref</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~100ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DRAM</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~16.000ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSD</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~2.000.000ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDD</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~50.000.000ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rede</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">~1.000.000.000ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fita</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Todos os dados de um banco de dados, em última instância, são armazenados em arquivos no sistema de arquivos. Esses arquivos podem ser organizados de diferentes maneiras, dependendo da implementação do banco de dados, mas geralmente são divididos em páginas ou blocos de tamanho fixo (por exemplo, 4KB ou 8KB). Cada página pode ser organizada por tuplas (linhas), log estruturado ou orientado a índices.</p>
</div>
<div class="sect2">
<h3 id="_gerenciador-de-transações-transaction-manager">Gerenciador de Transações (<em>Transaction Manager</em>)</h3>
<div class="paragraph">
<p>O gerenciador de transações é responsável por organizar a execução das transações garantindo que a base de dados esteja sempre em um estado consistente.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gerenciador-de-bloqueios-lock-manager">Gerenciador de Bloqueios (<em>Lock Manager</em>)</h3>
<div class="paragraph">
<p>O gerenciador de bloqueios é responsável por controlar o acesso concorrente aos dados envolvidos em transações concorrentes, garantindo o isolamento entre elas.</p>
</div>
</div>
<div class="sect2">
<h3 id="_métodos-de-acesso-access-methods">Métodos de Acesso (<em>Access Methods</em>)</h3>
<div class="paragraph">
<p>Os métodos de acesso são responsáveis por definir como os dados são organizados e acessados no armazenamento físico. Eles utilizam estruturas de dados como árvores B, árvores LSM e arquivos heap.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gerenciador-de-buffer-buffer-manager">Gerenciador de Buffer (<em>Buffer Manager</em>)</h3>
<div class="paragraph">
<p>O gerenciador de buffer é responsável por gerenciar a memória volátil (RAM) utilizada para armazenar temporariamente os dados que estão sendo lidos ou escritos no disco. Ele otimiza o desempenho do banco de dados reduzindo o número de acessos ao disco.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gerenciador-de-recuperação-recovery-manager">Gerenciador de Recuperação (<em>Recovery Manager</em>)</h3>
<div class="paragraph">
<p>O gerenciador de recuperação é responsável por garantir a integridade dos dados em caso de falhas, como quedas de energia ou erros de software. Ele utiliza técnicas como logs de transações e pontos de verificação para restaurar o banco de dados a um estado consistente após uma falha.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bancos de Dados são sistemas com diversas implementações diferentes, mas a maioria deles compartilha de funcionalidades e arquiteturas semelhantes. Entender como uma base de dados relacional é construída internamente pode nos ajudar a compreender melhor seu comportamento e com isso podemos tomar decisões mais informadas sobre o uso ou a escolha de uma base de dados.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Bases de Dados" /><category term="DBMS" /><category term="Banco de Dados" /><summary type="html"><![CDATA[Entenda a arquitetura interna de um sistema de gerenciamento de banco de dados relacional (DBMS) e como seus principais componentes funcionam juntos para armazenar, gerenciar e recuperar dados de forma eficiente.]]></summary></entry><entry><title type="html">Bases de Dados e o Modelo Relacional</title><link href="https://blog.vepo.dev/posts/introducao-a-bases-de-dados" rel="alternate" type="text/html" title="Bases de Dados e o Modelo Relacional" /><published>2025-12-19T00:00:00+00:00</published><updated>2025-12-19T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/09-15-00-bases-de-dados</id><content type="html" xml:base="https://blog.vepo.dev/posts/introducao-a-bases-de-dados"><![CDATA[<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Nota</div>
</td>
<td class="content">
Esse post é baseado nas notas sobre um curso que estou acompanhando no YouTube, chamado <a href="https://www.youtube.com/playlist?list=PLSE8ODhjZXjYMAgsGH-GtY5rJYZ6zjsd5">CMU Intro to Database Systems (15-445/645 - Fall 2025)</a>. O curso é ministrado por <a href="https://www.cs.cmu.edu/~pavlo/">Andy Pavlo</a> e cobre diversos tópicos relacionados a sistemas de banco de dados, incluindo arquitetura, indexação, transações, recuperação e muito mais. Todas as notas de aulas e os slides estão disponíveis na <a href="https://15445.courses.cs.cmu.edu/fall2025/schedule.html">página oficial do curso</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>O livro "<strong>O Guia do Mochileiro das Galáxias</strong>" traz uma grande lição. Em determinado momento, um supercomputador chamado Deep Thought é construído para responder a "<strong>A Pergunta Fundamental sobre a Vida, o Universo e Tudo Mais</strong>". Após milhões de anos de cálculo, o computador finalmente revela que a resposta é "<strong>42</strong>". No entanto, ninguém sabe qual é a pergunta. Se você não entendeu porque começar um post sobre bases de dados com uma referência a esse livro, é porque você não entendeu o que o autor Douglas Adams quis dizer com isso. Saber fazer boas perguntas é tão importante quanto ter boas respostas.</p>
</div>
<div class="sect1">
<h2 id="_o-que-são-bases-de-dados">O que são Bases de Dados?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Por isso, a primeira pergunta a ser feita é: <em>O que é uma base de dados?</em> Bases de dados são o ponto central da maioria dos sistemas de software modernos e muitos se confundem ao não saber como usá-las corretamente ou não entendem a diferença entre os vários tipos de bases de dados disponíveis. Dessa forma, vamos elaborar uma simples definição:</p>
</div>
<div class="paragraph">
<p><strong>Uma base de dados é uma coleção organizada de dados inter-relacionados que modelam alguns aspectos do mundo real.</strong></p>
</div>
<div class="paragraph">
<p>Agora que temos uma definição, precisamos entender que são só são úteis se estiverem corretos, acessíveis e seguros. Para isso, existem os Sistemas de Gerenciamento de Bases de Dados (SGBD, ou DBMS em inglês). Estes são sistemas de software que permitem armazenar e analizar informações em uma base de dados.</p>
</div>
<div class="paragraph">
<p>Uma solução óbvia é usar arquivos para armazenar dados. No entanto, não é uma boa ideia, pois para se garantir que os dados estejam integros e sejam duráveis, é necessário implementar diversas funcionalidades que um SGBD já oferece, como controle de concorrência, recuperação de falhas, segurança e muito mais.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-compõe-uma-base-de-dados">O que compõe uma base de dados?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Uma base de dados é sempre composta pelo <strong>modelo de dados</strong> e pelo <strong>esquema</strong>.</p>
</div>
<div class="paragraph">
<p><strong>O modelo de dados, ou <em>data model</em>, é uma coleção de conceitos que descrevem os dados em uma base de dados. O modelo de dados define os tipos de coisas que podem existir e como elas se relacionam entre si.</strong></p>
</div>
<div class="paragraph">
<p><strong>O esquema, ou <em>schema</em>, é a descrição de uma coleção de dados, usando um modelo de dados específico. Um esquema define a estrutura dos dados em um modelo de dados. Dados sem um esquema são apenas um conjunto de bits sem significado.</strong></p>
</div>
<div class="paragraph">
<p>Essas definições podem parecer confusas se não forem exemplificadas. Por isso vamos listar alguns modelos de dados?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Relational</p>
</li>
<li>
<p>Key/Value</p>
</li>
<li>
<p>Graph</p>
</li>
<li>
<p>Document/JSON/XML/Object</p>
</li>
<li>
<p>Wide-Column/Column-Family</p>
</li>
<li>
<p>Array (Vector, Matriz, Tensor)</p>
</li>
<li>
<p>Hierarchical/Tree</p>
</li>
<li>
<p>Network</p>
</li>
<li>
<p>Semantic</p>
</li>
<li>
<p>Entity-Relationship</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alguns desses modelos não são mais tão comuns, mas já foram usados no passado. O mais comum atualmente é o modelo relacional, que é usados em bases de dados que suportam SQL.</p>
</div>
<div class="paragraph">
<p>O modelo Key/Value é usado para aplicações simples e/ou <em>caching</em> de informações.</p>
</div>
<div class="paragraph">
<p>O que hoje se conhece como NoSQL, que não verdade não significa "não SQL", mas sim "not only SQL", é composto pelos modelos Graph, Document/JSON/XML/Object e Wide-Column/Column-Family. É importante ressaltar que não existe uma definição formal para a categoria NoSQL.</p>
</div>
<div class="paragraph">
<p>Os modelos Array são usados em bases de dados especializadas para aprendizado de máquina e inteligência artificial.</p>
</div>
<div class="paragraph">
<p>Já os modelos Hierarchical/Tree, Network, Semantic e Entity-Relationship são mais antigos e não são mais tão comuns.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quais-foram-as-primeiras-bases-de-dados">Quais foram as primeiras bases de dados?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nos anos 1960, as primeiras bases de dados obrigavam o desenvolvedor a escrever consultas (<em>queries</em>) usando código procedural. O desenvolvedor precisava dizer ao sistema exatamente como navegar pelos dados baseado no conteúdo da base. Se a base de dados fosse alterada, o código precisava ser reescrito.</p>
</div>
<div class="paragraph">
<p>Pode-se citar bases como IDS, IMS e CODASYL como exemplos desse tipo de base de dados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="idms"><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GET_ARTISTS_FOR_ALBUM</span><span class="p">;</span><span class="w">
</span><span class="k">BEGIN</span><span class="w">
    </span><span class="cm">/* Declare variables */</span><span class="w">
    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">ARTIST_RECORD</span><span class="w"> </span><span class="n">ARTIST</span><span class="p">;</span><span class="w">
    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">APPEARS_RECORD</span><span class="w"> </span><span class="n">APPEARS</span><span class="p">;</span><span class="w">
    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">ALBUM_RECORD</span><span class="w"> </span><span class="n">ALBUM</span><span class="p">;</span><span class="w">

    </span><span class="cm">/* Start navigation */</span><span class="w">
    </span><span class="k">FIND</span><span class="w"> </span><span class="n">ALBUM</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">ALBUM</span><span class="p">.</span><span class="n">NAME</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">"Mooshoo Tribute"</span><span class="w">
        </span><span class="k">ON</span><span class="w"> </span><span class="k">ERROR</span><span class="w"> </span><span class="k">DISPLAY</span><span class="w"> </span><span class="s2">"Album not found"</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">EXIT</span><span class="p">;</span><span class="w">

    </span><span class="cm">/* For each appearance on the album */</span><span class="w">
    </span><span class="k">FIND</span><span class="w"> </span><span class="k">FIRST</span><span class="w"> </span><span class="n">APPEARS</span><span class="w"> </span><span class="k">WITHIN</span><span class="w"> </span><span class="n">APPEARS_ALBUM</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">ALBUM_RECORD</span><span class="w">
        </span><span class="k">ON</span><span class="w"> </span><span class="k">ERROR</span><span class="w"> </span><span class="k">DISPLAY</span><span class="w"> </span><span class="s2">"No artists found for this album"</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">EXIT</span><span class="p">;</span><span class="w">

    </span><span class="cm">/* Loop through the set of APPEARS */</span><span class="w">
    </span><span class="k">REPEAT</span><span class="w">
        </span><span class="cm">/* Navigate to the corresponding artist */</span><span class="w">
        </span><span class="k">FIND</span><span class="w"> </span><span class="k">OWNER</span><span class="w"> </span><span class="k">WITHIN</span><span class="w"> </span><span class="n">ARTIST_APPEARS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">APPEARS_RECORD</span><span class="w">
            </span><span class="k">ON</span><span class="w"> </span><span class="k">ERROR</span><span class="w"> </span><span class="k">DISPLAY</span><span class="w"> </span><span class="s2">"Error finding artist"</span><span class="p">;</span><span class="w">
        </span><span class="cm">/* Display artist name */</span><span class="w">
        </span><span class="k">DISPLAY</span><span class="w"> </span><span class="n">ARTIST_RECORD</span><span class="p">.</span><span class="n">NAME</span><span class="p">;</span><span class="w">
        </span><span class="cm">/* Move to the next APPEARS record in the set */</span><span class="w">
        </span><span class="k">FIND</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="n">APPEARS</span><span class="w"> </span><span class="k">WITHIN</span><span class="w"> </span><span class="n">APPEARS_ALBUM</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">ALBUM_RECORD</span><span class="w">
            </span><span class="k">ON</span><span class="w"> </span><span class="k">ERROR</span><span class="w"> </span><span class="k">EXIT</span><span class="p">;</span><span class="w">
    </span><span class="k">END</span><span class="w"> </span><span class="k">REPEAT</span><span class="p">;</span><span class="w">
</span><span class="k">END</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As bases de dados que conhecemos hoje começaram a ser desenvolvidas no início dos anos 1970 por nomes como Edgar F. Codd, Charles W. Bachman, Jim Gray e Michael Stonebraker. Para acompanhar a discussão, pode-se ler os artigos do SIGMOD de 1970 a 1947 em <a href="https://www.sigmod.org/publications/dblp/db/conf/sigmod/sigfidet.html">ACM SIGFIDET/SIGMOD Workshop on Data Description, Access and Control</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-define-o-modelo-relacional">O que define o modelo relacional?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para entender o modelo relacional é preciso definir uma <strong>relação</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Uma relação é um conjunto não ordenado que contém a relação entre atributos que representam entidades.</strong></p>
</div>
<div class="paragraph">
<p>Uma relação com n atributos é chamada de n-ária. Por exemplo, uma relação com três atributos é chamada de ternária. Apesar da palavra "relação" remeter a relacionamento, no contexto de bases de dados relacionais, ela pode ser usada como sinônimo de tabela. Cada relação é composta por tuplas (linhas). Para isso precisamos definir o que são tuplas.</p>
</div>
<div class="paragraph">
<p><strong>Uma tupla é um conjunto de atributos em uma relação. Esses valores são atômicos ou escalares.</strong> Por "escalar" entende-se um valor númerico, string, data/hora, booleano, etc. E por "atômico" entende-se que o valor não pode ser dividido em partes menores.</p>
</div>
<div class="paragraph">
<p>Em um modelo relacional, cada relação pode ter propriedades que garantem a integridade dos dados. São elas: <strong>chave primária</strong> (<em>primary key</em>), <strong>chave estrangeira</strong> (<em>foreign key</em>) e <strong>restrições de integridade</strong> (<em>constraints</em>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uma chave primária de uma relação é um conjunto de atributos que identifica unicamente cada tupla na relação.</p>
</li>
<li>
<p>Uma chave estrangeira é um conjunto de atributos em uma relação que referencia a chave primária de outra relação, estabelecendo um vínculo entre as duas relações.</p>
</li>
<li>
<p>Uma restrição é uma condição definida pelo usuário que deve ser válida para qualquer instância do banco de dados. A chave primária e a chave estrangeira são tipos especiais de restrições, mas existem outras, como restrições de unicidade e restrições de nulidade.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_como-interagir-com-bases-de-dados-relacionais">Como interagir com bases de dados relacionais?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Toda base de dados fornecerá uma linguagem de manipulação de dados (DML, <em>Data Manipulation Language</em>) para interagir com os dados armazenados. A DML mais comum é a Structured Query Language (SQL). O SQL é uma linguagem declarativa que pode ser dividida em cinco partes principais: Linguagem de Manipulação de Dados (DML, <em>Data Manipulation Language</em>), Linguagem de Definição de Dados (DDL, <em>Data Definition Language</em>), Linguagem de Controle de Dados (DCL, <em>Data Control Language</em>), Linguagem de Transação de Dados (TCL, <em>Transaction Control Language</em>) e Linguagem de Consulta de Dados (DQL, <em>Data Query Language</em>).</p>
</div>
<div class="paragraph">
<p>Abaixo estão alguns exemplos de comandos SQL para cada uma dessas partes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DML: <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code></p>
</li>
<li>
<p>DDL: <code>CREATE</code>, <code>ALTER</code>, <code>DROP</code></p>
</li>
<li>
<p>TCL: <code>GRANT</code>, <code>REVOKE</code></p>
</li>
<li>
<p>DTL: <code>COMMIT</code>, <code>ROLLBACK</code></p>
</li>
<li>
<p>DQL: <code>SELECT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Essas linguagens podem ser usadas em conjunto para criação de scripts que automatizam tarefas de administração e manipulação de dados em uma base de dados relacional.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neste post, vimos uma introdução ao conceito de bases de dados, modelos de dados, esquema, história das bases de dados e o modelo relacional. Nos próximos posts, vamos entender o que é Algebra Relacional e como ela define as operações que podem ser realizadas em bases de dados relacionais.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Bases de Dados" /><category term="Modelos de Dados" /><category term="SQL" /><category term="História da Computação" /><summary type="html"><![CDATA[Neste post, vamos explorar os conceitos fundamentais de bases de dados, incluindo o que são, como funcionam e a história por trás do modelo relacional.]]></summary></entry><entry><title type="html">SQL e a Álgebra Relacional</title><link href="https://blog.vepo.dev/posts/sql-e-a-algebra-relacional" rel="alternate" type="text/html" title="SQL e a Álgebra Relacional" /><published>2025-12-19T00:00:00+00:00</published><updated>2025-12-19T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/12-24-00-sql-e-a-algebra-relacional</id><content type="html" xml:base="https://blog.vepo.dev/posts/sql-e-a-algebra-relacional"><![CDATA[<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Nota</div>
</td>
<td class="content">
Esse post é baseado nas notas sobre um curso que estou acompanhando no YouTube, chamado <a href="https://www.youtube.com/playlist?list=PLSE8ODhjZXjYMAgsGH-GtY5rJYZ6zjsd5">CMU Intro to Database Systems (15-445/645 - Fall 2025)</a>. O curso é ministrado por <a href="https://www.cs.cmu.edu/~pavlo/">Andy Pavlo</a> e cobre diversos tópicos relacionados a sistemas de banco de dados, incluindo arquitetura, indexação, transações, recuperação e muito mais. Todas as notas de aulas e os slides estão disponíveis na <a href="https://15445.courses.cs.cmu.edu/fall2025/schedule.html">página oficial do curso</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>No post anterior, discutimos o que são bases de dados, os modelos de dados mais comuns e a história por trás do modelo relacional. Neste post, vamos explorar a álgebra relacional, que é a base teórica para o SQL, a linguagem de consulta mais utilizada em bases de dados relacionais.</p>
</div>
<div class="sect1">
<h2 id="_o-que-é-sql">O que é SQL?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Como já falamos antes, SQL significa Structured Query Language (Linguagem de Consulta Estruturada) dessa breve definição já podemos extrair duas informações muito valiosas: SQL é uma linguagem e SQL é usada para fazer consultas.</p>
</div>
<div class="paragraph">
<p>Todas as linguagens na computação possuem uma <strong>sintaxe</strong>, uma <strong>semântica</strong> e um proposito. Muitas pessoas gostam muito de pensar que toda linguagem é uma linguagem de programação, mas isso não é verdade. SQL é usada para interagir com bases de dados. HTML é usada para estruturar documentos web. CSS é usada para adicionar estilo. E existem as linguagens de programação de propósito geral, como Python, Java, C, JavaScript, entre outras.</p>
</div>
<div class="paragraph">
<p>O SQL por sua vez não é uma linguagem especifica de um banco de dados, mas sim um padrão suportado por diversos sistemas. Ela é especificada pela ISO (International Organization for Standardization) e pela ANSI (American National Standards Institute). O padrão SQL é atualizado periodicamente para incluir novos recursos e melhorias. Alguns dos sistemas de gerenciamento de banco de dados relacionais (SGBDR) mais populares que suportam SQL incluem MySQL, PostgreSQL, Oracle Database, Microsoft SQL Server e SQLite. A linguagem SQL é constantemente atualizada para incluir novos recursos e melhorias, mas as bases de dados nem sempre implementam todas as funcionalidades do padrão.</p>
</div>
<div class="paragraph">
<p>Por exemplo, algumas das versões do padrão SQL incluem:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Tabela 1. Versões do Padrão SQL e Principais Recursos</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Nome da Versão</th>
<th class="tableblock halign-center valign-top">Ano</th>
<th class="tableblock halign-left valign-top">Especificação</th>
<th class="tableblock halign-left valign-top">Principais Recursos Introduzidos</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:1986</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1986</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSI X3.135:1986<br>
ISO/IEC 9075:1987<br>
FIPS PUB 127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Padrão inicial</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:1989</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1989</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSI X3.135-1989<br>
ISO/IEC 9075:1989<br>
FIPS PUB 127-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integridade (<em>Constraints</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:1992</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1992</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANSI X3.135-1992<br>
ISO/IEC 9075:1992<br>
FIPS PUB 127-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suport a Unions, Joins, Case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:1999</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075:1999</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expressões Regulares, Triggers, Queries recursivas</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2003</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075:2003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML, Windows, Sequences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2006</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075-14:2006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suporte aprimorado para XML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2008</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075:2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truncation, Fancy Sorting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2011</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075:2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporal DBs, Fetch e Windows Functions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2016</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2016</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075:2016</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON, Polymorphic tables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2019</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075-15:2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-Dimensional Arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL:2023</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2023</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO/IEC 9075-2023</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Graph Queries</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_o-que-é-álgebra-relacional">O que é Álgebra Relacional?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Agora que entendemos o que é SQL, temos que nos perguntar porque a linguagem é baseada na álgebra relacional e o que é essa tal de álgebra relacional.</p>
</div>
<div class="paragraph">
<p><strong><em>A Álgebra Relacional é um conjunto de operações fundamentais para recuperar e manipular tuplas em uma relação. Cada operador recebe uma ou mais relações como entrada e produz uma nova relação como saída. Para escrever consultas, podemos "encadear" esses operadores.</em></strong></p>
</div>
<div class="paragraph">
<p>A álgebra relacional é uma derivação da lógica de primeira ordem e da teoria dos conjuntos com o propósito de prover operações que possam ser usadas para selecionar e manipular dados em bases relacionais (ver o livro <em>Relational completeness of data base sublanguages</em>).</p>
</div>
<div class="paragraph">
<p>Em uma base relacional, podemos imaginar que cada relação (ou tabela) é um conjunto de tuplas que podem ser manipuladas por meio de operações da álgebra relacional. As principais operações são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Seleção (σ)</strong>: Seleciona tuplas que satisfazem uma condição específica.</p>
</li>
<li>
<p><strong>Projeção (π)</strong>: Seleciona colunas específicas de uma relação.</p>
</li>
<li>
<p><strong>União (∪)</strong>: Combina tuplas de duas relações, removendo duplicatas.</p>
</li>
<li>
<p><strong>Interseção (∩)</strong>: Retém apenas as tuplas que estão presentes em ambas as relações.</p>
</li>
<li>
<p><strong>Diferença (-)</strong>: Retira tuplas de uma relação que também estão em outra relação.</p>
</li>
<li>
<p><strong>Produto Cartesiano (×)</strong>: Combina todas as tuplas de duas relações possíveis.</p>
</li>
<li>
<p><strong>Junção (⨝)</strong>: Combina tuplas de duas relações com base em uma condição de correspondência.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nas próximas seções, vamos explorar cada uma dessas operações e como elas se relacionam com consultas SQL comuns. Para exemplificar, vamos usar as seguintes relações:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">Aluno(ID, Nome, Idade)
Curso(Codigo, Nome, Creditos)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_seleção-σ">Seleção (σ)</h3>
<div class="paragraph">
<p>A seleção recebe uma relação e retorna um subconjunto das tuplas dessa relação que satisfazem um predicado da seleção. O predicado atua como um filtro, e podemos combinar múltiplos predicados usando conjunções e disjunções.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-seleção">Exemplo de Seleção</h4>
<div class="paragraph">
<p>Dado a relação Alunos, podemos selecionar todos os alunos com idade maior que 20 anos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a seleção σ(Idade &gt; 20)(Aluno), obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
003     Carol     23
004     Dave      21
008     Heidi     24
009     Ivan      22</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_projeção-π">Projeção (π)</h3>
<div class="paragraph">
<p>A projeção recebe uma relação como entrada e retorna uma relação com tuplas que contêm apenas os atributos especificados. Você pode reorganizar a ordem dos atributos na relação de entrada, bem como manipular os valores.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-projeção">Exemplo de Projeção</h4>
<div class="paragraph">
<p>Dado a relação Alunos, podemos projetar apenas os nomes dos alunos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a projeção π(Nome)(Aluno), obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">Alice
Bob
Carol
Dave
Eve
Frank
Grace
Heidi
Ivan
Judy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_união">União (∪)</h3>
<div class="paragraph">
<p>A união recebe duas relações e retorna uma relação que contém todas as tuplas que aparecem em pelo menos uma das relações de entrada. Observação: as duas relações de entrada devem ter exatamente os mesmos atributos.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-união">Exemplo de União</h4>
<div class="paragraph">
<p>Dadas as relações Aluno1 e Aluno2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">011     Kevin     20
012     Laura     21
013     Mallory   22
014     Nancy     23
015     Oscar     24</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a união Aluno1 ∪ Aluno2, obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19
011     Kevin     20
012     Laura     21
013     Mallory   22
014     Nancy     23
015     Oscar     24</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interseção">Interseção (∩)</h3>
<div class="paragraph">
<p>A interseção recebe duas relações e retorna uma relação que contém todas as tuplas que aparecem em ambas as relações de entrada. Observação: as duas relações de entrada devem ter exatamente os mesmos atributos.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-interseção">Exemplo de Interseção</h4>
<div class="paragraph">
<p>Dadas as relações Aluno1 e Aluno2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">002     Bob       19
003     Carol     23
004     Dave      21
006     Frank     17
007     Grace     20
009     Ivan      22
011     Kevin     20
013     Mallory   22
015     Oscar     24</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a interseção Aluno1 ∩ Aluno2, obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">002     Bob       19
003     Carol     23
004     Dave      21
006     Frank     17
007     Grace     20
009     Ivan      22</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_diferença">Diferença (-)</h3>
<div class="paragraph">
<p>A diferença recebe duas relações e retorna uma relação que contém todas as tuplas que aparecem na primeira relação, mas não na segunda. Observação: as duas relações de entrada devem ter exatamente os mesmos atributos.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-diferença">Exemplo de Diferença</h4>
<div class="paragraph">
<p>Dadas as relações Aluno1 e Aluno2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23
004     Dave      21
005     Eve       18
006     Frank     17
007     Grace     20
008     Heidi     24
009     Ivan      22
010     Judy      19</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">002     Bob       19
003     Carol     23
004     Dave      21
006     Frank     17
007     Grace     20
009     Ivan      22
011     Kevin     20
013     Mallory   22
015     Oscar     24</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a diferença Aluno1 - Aluno2, obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
005     Eve       18
008     Heidi     24
010     Judy      19</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_produto-cartesiano">Produto Cartesiano (×)</h3>
<div class="paragraph">
<p>O produto cartesiano recebe duas relações e retorna uma relação que contém todas as combinações possíveis de tuplas das relações de entrada.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-produto-cartesiano">Exemplo de Produto Cartesiano</h4>
<div class="paragraph">
<p>Dadas as relações Aluno e Curso:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">C001    Matemática     4
C002    Física         3
C003    Química        4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando o produto cartesiano Aluno × Curso, obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22    C001    Matemática     4
001     Alice     22    C002    Física         3
001     Alice     22    C003    Química        4
002     Bob       19    C001    Matemática     4
002     Bob       19    C002    Física         3
002     Bob       19    C003    Química        4
003     Carol     23    C001    Matemática     4
003     Carol     23    C002    Física         3
003     Carol     23    C003    Química        4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_junção">Junção (⨝)</h3>
<div class="paragraph">
<p>A junção recebe duas relações e retorna uma relação que contém todas as tuplas que são uma combinação de duas tuplas, onde, para cada atributo que as duas relações compartilham, os valores desse atributo em ambas as tuplas são iguais.</p>
</div>
<div class="sect3">
<h4 id="_exemplo-de-junção">Exemplo de Junção</h4>
<div class="paragraph">
<p>Dadas as relações Aluno e Curso:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22
002     Bob       19
003     Carol     23</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001    Matemática     4
002    Física         3
003    Química        4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aplicando a junção Aluno ⨝ Curso usando o ID = Codigo, obtemos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plaintext">001     Alice     22    Matemática     4
002     Bob       19    Física         3
003     Carol     23    Química        4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_como-a-álgebra-relacional-se-relaciona-com-sql">Como a Álgebra Relacional se Relaciona com SQL?</h3>
<div class="paragraph">
<p>Agora vamos ver como essas operações da álgebra relacional se traduzem em consultas SQL. É importante ressaltar que as consultas SQL apresentadas abaixo são apenas demonstrativas e não são otimizadas para desempenho.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Dica</div>
</td>
<td class="content">
Você pode encontrar os exemplos no repositório <a href="https://github.com/vepo/sql-database-tutorial">vepo/sql-database-tutorial</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As consultas SQL a seguir são baseadas nas seguintes tabelas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">employees</span> <span class="p">(</span>
    <span class="n">id</span>         <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">department</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">salary</span>     <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">hire_date</span>  <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">created_at</span> <span class="nb">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">departments</span> <span class="p">(</span>
    <span class="n">id</span>        <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">dept_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">budget</span>    <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="k">location</span>  <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">projects</span> <span class="p">(</span>
    <span class="n">id</span>            <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">project_name</span>  <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">start_date</span>    <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">end_date</span>      <span class="nb">DATE</span><span class="p">,</span>
    <span class="n">budget</span>        <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">department_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">departments</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_seleção-em-sql">Seleção em SQL</h4>
<div class="paragraph">
<p>A seleção no SQL é realizada pela cláusula <code>SELECT [campos] FROM [tabela] WHERE [condição]</code>. Onde uma condição é aplicada a uma ou mais tabelas e retorna um subconjunto de tuplas selecioadas pelos campos. No exemplo abaixo, selecionamos todos os funcionários com salário maior que 100000 e nenhuma projeção de campos é feita, uma vez que usamos o asterisco (*) para selecionar todos os campos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Seleciona todos os funcionários com salário maior que 100000</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_projeção-em-sql">Projeção em SQL</h4>
<div class="paragraph">
<p>A projeção no SQL é realizada pela cláusula <code>SELECT [campos] FROM [tabela]</code>. Onde os campos especificados são retornados para todas as tuplas da tabela. No exemplo abaixo, projetamos apenas os campos <code>id</code>, <code>name</code> e <code>department</code> da tabela <code>employees</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Projeta os campos id, name e department da tabela employees</span>
<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">department</span> <span class="k">FROM</span> <span class="n">employees</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_união-em-sql">União em SQL</h4>
<div class="paragraph">
<p>A união no SQL é realizada pela cláusula <code>UNION</code> entre duas consultas <code>SELECT</code>. Ambas as consultas devem retornar o mesmo número de colunas e tipos de dados compatíveis. No exemplo abaixo, selecionamos todos os funcionários com salário menor que 60000 e todos os funcionários com salário maior que 100000, combinando os resultados usando a união.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Criar união de duas consultas</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">60000</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse exemplo não é o mais eficiente, visto que ambas as consultas são feitas na mesma tabela. O <code>UNION</code> não é restrito a uma só tabela, a única exigência é que as consultas retornem o mesmo número de colunas e tipos de dados compatíveis. Essa consulta pode ser reescrita de uma forma mais eficiente usando o operador lógico <code>OR</code>, como mostrado abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Versão mais eficiente usando OR</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">60000</span> <span class="k">OR</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interseção-em-sql">Interseção em SQL</h4>
<div class="paragraph">
<p>A interseção no SQL é realizada pela cláusula <code>INTERSECT</code> entre duas consultas <code>SELECT</code>. Ambas as consultas devem retornar o mesmo número de colunas e tipos de dados compatíveis. No exemplo abaixo, selecionamos todos os funcionários com salário maior que 60000 e todos os funcionários com salário menor que 100000, retornando apenas os funcionários que satisfazem ambas as condições.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Criar interseção de duas consultas</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">60000</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse também não é um exemplo eficiente, visto que ambas as consultas são feitas na mesma tabela. A interseção pode ser reescrita de uma forma mais eficiente usando o operador lógico <code>AND</code>, como mostrado abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Versão mais eficiente usando AND</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">60000</span> <span class="k">AND</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_diferença-em-sql">Diferença em SQL</h4>
<div class="paragraph">
<p>A diferença no SQL é realizada pela cláusula <code>EXCEPT</code> entre duas consultas <code>SELECT</code>. Ambas as consultas devem retornar o mesmo número de colunas e tipos de dados compatíveis. No exemplo abaixo, selecionamos todos os funcionários com salário maior que 60000 e menor que 100000, e removemos aqueles que trabalham no departamento de TI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Criar diferença de duas consultas</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">60000</span> <span class="k">AND</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="n">department</span> <span class="o">=</span> <span class="s1">'IT'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse exemplo também não é o mais eficiente, visto que ambas as consultas são feitas na mesma tabela. A diferença pode ser reescrita de uma forma mais eficiente usando o operador lógico <code>AND</code> junto com o operador <code>NOT</code>, como mostrado abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Versão mais eficiente usando AND e NOT</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">60000</span> <span class="k">AND</span> <span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">)</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="p">(</span><span class="n">department</span> <span class="o">=</span> <span class="s1">'IT'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_produto-cartesiano-em-sql">Produto Cartesiano em SQL</h4>
<div class="paragraph">
<p>O produto cartesiano no SQL é realizado pela cláusula <code>CROSS JOIN</code> entre duas tabelas. No exemplo abaixo, combinamos todas as tuplas da tabela <code>employees</code> com todas as tuplas da tabela <code>departments</code>, resultando em todas as combinações possíveis de funcionários e departamentos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Produto cartesiano entre employees e departments</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">departments</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse exemplo definitivamente não é o mais eficiente, visto que o produto cartesiano geralmente não tão comumente usado em consultas reais. Normalmente, o produto cartesiano é seguido por uma cláusula <code>WHERE</code> para filtrar os resultados com base em uma condição específica. Por exemplo, podemos combinar o produto cartesiano com uma condição para selecionar apenas os funcionários que trabalham em um departamento específico:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Produto cartesiano com condição de filtro</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">employees</span> <span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">departments</span>
<span class="k">WHERE</span> <span class="n">department</span> <span class="o">=</span> <span class="n">dept_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esse exemplo é também ineficiente por usar um campo textual para fazer a junção entre as tabelas. O ideal seria usar uma chave estrangeira para fazer a junção, como será mostrado no <code>JOIN</code> abaixo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_junção-em-sql">Junção em SQL</h4>
<div class="paragraph">
<p>A junção no SQL é realizada pela cláusula <code>JOIN</code> entre duas tabelas, geralmente acompanhada por uma condição <code>ON</code> que especifica como as tabelas devem ser combinadas. No exemplo abaixo, combinamos as tabelas <code>departments</code> e <code>projects</code> com base na correspondência entre o campo <code>id</code> da tabela <code>departments</code> e o campo <code>department_id</code> da tabela <code>projects</code>. Em seguida, agrupamos os resultados pelo campo <code>dpt.id</code> e contamos o número de projetos associados a cada departamento.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">dpt</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">prj</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">projects</span>
<span class="k">FROM</span> <span class="n">departments</span> <span class="n">dpt</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">projects</span> <span class="n">prj</span> <span class="k">ON</span> <span class="n">dpt</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">prj</span><span class="p">.</span><span class="n">department_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dpt</span><span class="p">.</span><span class="n">id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Talvez você tenha notado que o <strong>Produto Cartesiano</strong> e a <strong>Junção</strong> são operações muito semelhantes usando tipos diferentes de <code>JOIN</code>. Na <strong>Junção</strong> há a obrigatoriedade de definir uma condição de junção. No SQL, existem diversos tipos de operadores <code>JOIN</code>, incluindo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CROSS JOIN</strong>: Realiza o produto cartesiano entre duas tabelas.</p>
</li>
<li>
<p><strong>INNER JOIN</strong>: Retorna apenas as tuplas que possuem correspondência em ambas as tabelas com base na condição especificada.</p>
</li>
<li>
<p><strong>LEFT JOIN</strong>: Retorna todas as tuplas da tabela à esquerda e as tuplas correspondentes da tabela à direita. Se não houver correspondência, os valores da tabela à direita serão nulos.</p>
</li>
<li>
<p><strong>RIGHT JOIN</strong>: Retorna todas as tuplas da tabela à direita e as tuplas correspondentes da tabela à esquerda. Se não houver correspondência, os valores da tabela à esquerda serão nulos.</p>
</li>
<li>
<p><strong>FULL JOIN</strong>: Retorna todas as tuplas de ambas as tabelas, preenchendo com nulos onde não houver correspondência.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/databases/join-types.png" alt="join types">
</div>
<div class="title">Figura 1. Tipos de JOIN</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusão">Conclusão</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nesse post, exploramos como a álgebra relacional serve como a base teórica para o SQL. É importante ter ciência dessas operações fundamentais quando se escreve consultas SQL, visto que toda consulta SQL pode ser vista como uma operação de conjuntos. Compreender a álgebra relacional ajuda a escrever consultas mais eficientes e a entender como os sistemas de gerenciamento de banco de dados processam essas consultas.</p>
</div>
<div class="paragraph">
<p>Talvez você tenha pensado que essas consultas poderiam ter sido escritas de forma mais eficiente, mas o objetivo aqui foi apenas ilustrar como as operações da álgebra relacional se traduzem em SQL. Em posts futuros, exploraremos técnicas de otimização de consultas e como os SGBDs processam essas consultas para melhorar o desempenho usando chaves e índices.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Bases de Dados" /><category term="Algebra Relacional" /><category term="SQL" /><summary type="html"><![CDATA[Nesse post, vamos explorar a álgebra relacional, que é a base teórica para o SQL, a linguagem de consulta mais utilizada em bases de dados relacionais.]]></summary></entry><entry><title type="html">Como implementar um seletor de números sequenciais no Apache Kafka</title><link href="https://blog.vepo.dev/posts/como-implementar-um-seletor-de-numeros-sequenciais-no-apache-kafka" rel="alternate" type="text/html" title="Como implementar um seletor de números sequenciais no Apache Kafka" /><published>2025-11-21T00:00:00+00:00</published><updated>2025-11-21T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/11-42-00-numero-sequencia-kafka</id><content type="html" xml:base="https://blog.vepo.dev/posts/como-implementar-um-seletor-de-numeros-sequenciais-no-apache-kafka"><![CDATA[<div class="paragraph">
<p>Este relato é baseado em uma situação real do projeto em que atuo. Nossa solução utiliza Apache Kafka para processar CDRs (Call Detail Records), lidando com bilhões de registros diários. Todo o fluxo é construído em torno do Kafka, em um sistema que já opera em vários países, sob diferentes clientes e infraestruturas. Cada novo serviço incorporado ao ecossistema precisa ser planejado, justificado, implantado e mantido — o que torna a introdução de qualquer sistema adicional, por mais simples que pareça, uma tarefa nada trivial.</p>
</div>
<div class="paragraph">
<p>Foi nesse contexto que surgiu uma necessidade aparentemente simples: em determinado ponto do processo, seria necessário utilizar números sequenciais como identificadores para um novo recurso.</p>
</div>
<div class="sect1">
<h2 id="_a-solução-óbvia">A solução óbvia</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A primeira solução considerada foi: <em>"vamos adotar uma ferramenta pronta que já resolva isso"</em>. Poderíamos implementar um contador simples usando Redis ou, como alternativa, o próprio Zookeeper.</p>
</div>
<div class="paragraph">
<p>Ambas as tecnologias oferecem suporte nativo para essa funcionalidade. O Redis dispõe do comando <a href="https://redis.io/docs/latest/commands/incr/">INCR</a>, que incrementa um valor associado a uma chave e retorna o resultado atualizado. Já o Zookeeper trabalha com o conceito de nós sequenciais — ou seja, cada novo nó criado recebe automaticamente um sufixo numérico incremental.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="no">SET</span> <span class="n">mykey</span> <span class="s2">"10"</span>
<span class="s2">"OK"</span>
<span class="no">INCR</span> <span class="n">mykey</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">11</span>
<span class="no">GET</span> <span class="n">mykey</span>
<span class="s2">"11"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Uma alternativa mais robusta seria utilizar o <a href="https://redis.io/docs/latest/develop/clients/patterns/distributed-locks/">Redis</a> ou o <a href="https://zookeeper.apache.org/doc/r3.8.5/recipes.html#sc_recipes_Locks">Zookeeper</a> para implementar um Lock Distribuído, garantindo que apenas um processo por vez possa incrementar o contador. No entanto, essa abordagem é mais complexa e desnecessária, uma vez que ambas as tecnologias já oferecem suporte nativo para a funcionalidade de contador.</p>
</div>
<div class="paragraph">
<p>Em alguns clientes, usar o Zookeeper parecia uma solução simples, já que na época ele ainda era um componente integral do Kafka. No entanto, dois grandes obstáculos se apresentavam.</p>
</div>
<div class="paragraph">
<p>Primeiro: embora o Kafka utilizasse o Zookeeper para gerenciar o estado do cluster, nossa aplicação não tinha usava essa tecnologia. Além disso, já estava em curso a remoção do Zookeeper do ecossistema do Kafka, justamente por ser considerado uma das fontes de gargalo.</p>
</div>
<div class="paragraph">
<p>O segundo problema era que muitos clientes já haviam migrado para soluções de Kafka gerenciado (Managed Kafka), onde o serviço é oferecido como um produto em nuvem — e nessas situações, não tínhamos acesso ao Zookeeper. Portanto, mesmo que ele estivesse presente, não podíamos contar com essa solução.</p>
</div>
<div class="paragraph">
<p>Nessa implementação, a vazão não seria um problema crítico, pois os números sequenciais seriam usados apenas para identificar lotes de registros — e não cada registro individualmente. Isso significa que a taxa de consumo desses sequenciais seria bastante reduzida.</p>
</div>
<div class="paragraph">
<p>Há ainda outro aspecto fundamental: é impossível estabelecer uma sequência numérica global sem algum tipo de coordenação centralizada. Seja usando Redis ou Zookeeper, a solução continuaria sendo centralizada por natureza — o que, em cenários de alto volume, naturalmente limita a vazão máxima.</p>
</div>
<div class="paragraph">
<p>Diante dessas restrições, o Apache Kafka surgia como a única solução viável.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a-solução-ingênua">A solução ingênua!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Antes de mergulharmos na solução com Kafka, preciso descartar uma ideia que surgiu durante a discussão — e que, com o perdão da palavra, era tecnicamente ingênua.</p>
</div>
<div class="paragraph">
<p><em>— Por que não usar um simples arquivo de lock compartilhado?</em></p>
</div>
<div class="paragraph">
<p>Sim, essa sugestão realmente apareceu, proposta por um desenvolvedor. Se você também considerou essa possibilidade, vamos revisar alguns conceitos básicos de Sistemas Operacionais e Docker para entender por que ela não se aplica ao nosso cenário.</p>
</div>
<div class="paragraph">
<p>O bloqueio por arquivo (<em>file lock</em>) não é uma funcionalidade do sistema de arquivos em si, mas sim implementada diretamente no kernel do sistema operacional. Isso significa que, para essa solução funcionar, todos os processos envolvidos precisariam estar executando no mesmo sistema operacional — o que equivaleria a ter um "sistema operacional distribuído", um conceito não muito comum na prática.</p>
</div>
<div class="paragraph">
<p>Além disso, a solução se mostrava inviável em ambientes containerizados. Quando o Docker cria um namespace para um container, ele isola também o sistema de arquivos — o que impede o compartilhamento do <em>lock</em> entre containers.</p>
</div>
<div class="paragraph">
<p>Para comprovar essa limitação, conduzi um teste simples: o <em>lock</em> funcionou corretamente quando duas JVMs eram executadas diretamente na mesma máquina, sem Docker. No entanto, ao usar containers, o mecanismo deixou de funcionar. Ainda assim, me pediram para testar no Kubernetes&#8230;&#8203; e tive que investir mais tempo para demonstrar, novamente, que a abordagem não era viável.</p>
</div>
<div class="paragraph">
<p>No final, conseguimos resolver o problema — e comprovei que o Kafka era, de fato, a única solução viável.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decompondo-o-problema">Decompondo o problema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tínhamos, portanto, um desafio complexo e uma ferramenta que não havia sido projetada para resolvê-lo. Como superar essa situação? A estratégia foi decompor o problema em partes menores.</p>
</div>
<div class="paragraph">
<p>A geração de números sequenciais pode ser decomposta em dois componentes principais: (i) eleição de um líder e (ii) implementação de uma memória compartilhada. Para simplificar o processo, decidi desenvolver um código básico que serviria como base para a implementação final.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">try</span><span class="o">(</span><span class="nc">Leader</span> <span class="n">leader</span> <span class="o">=</span> <span class="n">consensus</span><span class="o">.</span><span class="na">acquireLeader</span><span class="o">())</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">currentValue</span> <span class="o">=</span> <span class="n">leader</span><span class="o">.</span><span class="na">getInteger</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="c1">// use currentValue</span>
    <span class="n">leader</span><span class="o">.</span><span class="na">setInteger</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">currentValue</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este código foi propositalmente desenvolvido com simplicidade e organizado em três interfaces principais:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>acquireLeader</code>: método bloqueante que aguarda até que um líder seja eleito</p>
</li>
<li>
<p><code>getInteger</code> e <code>setInteger</code>: para leitura e escrita de valores na memória compartilhada</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apenas o líder possui permissão para modificar os valores na memória compartilhada. Por isso, os métodos de leitura e escrita (<code>getInteger</code>/<code>setInteger</code>) estão disponíveis apenas na interface <code>Leader</code>. Já a interface <code>Consensus</code> contém apenas o método <code>acquireLeader</code>, responsável por coordenar a eleição de forma bloqueante.</p>
</div>
<div class="paragraph">
<p>Dessa forma, o código principal da aplicação permaneceria isolado da complexidade inerente à eleição de líder e ao gerenciamento da memória compartilhada.</p>
</div>
<div class="paragraph">
<p>Com a abstração definida, era hora de implementar os algoritmos necessários para colocar toda a solução em funcionamento.</p>
</div>
<div class="sect2">
<h3 id="_como-o-kafka-permite-consenso">Como o Kafka permite consenso</h3>
<div class="paragraph">
<p>O Apache Kafka é um <a href="https://www.researchgate.net/publication/378309830_Middlewares_Orientados_a_Mensagens">middleware orientado a mensagens</a> que permite a integração entre sistemas por meio do envio e recebimento de eventos. Existem dois modelos de comunicação comuns nesse contexto: Ponto a Ponto e Publish/Subscribe.</p>
</div>
<div class="paragraph">
<p>O Kafka adota exclusivamente o modelo Publish/Subscribe. Nele, o broker organiza os eventos em tópicos, onde produtores publicam mensagens e consumidores as leem de forma sequencial.</p>
</div>
<div class="paragraph">
<p>Por sua natureza distribuída, os tópicos no Kafka são divididos em partições. Cada partição atua como um log segmentado — ou seja, o broker sempre grava as mensagens recebidas no final de um arquivo, até que este atinja seu limite e um novo arquivo seja criado.</p>
</div>
<div class="paragraph">
<p>Ao produzir uma mensagem, o produtor pode escolher explicitamente a partição de destino ou, alternativamente, utilizar uma chave para que a partição seja determinada automaticamente. Em ambos os casos, a mensagem é armazenada de forma sequencial dentro da partição.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Referências</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://dl.acm.org/doi/10.14778/2824032.2824063">Building a replicated logging system with Apache Kafka</a></p>
</li>
<li>
<p><a href="https://ieeexplore.ieee.org/document/9005583">Kafka: the Database Inverted, but Not Garbled or Compromised</a></p>
</li>
<li>
<p><a href="https://notes.stephenholiday.com/Kafka.pdf">Kafka: a Distributed Messaging System for Log Processing</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/topico.png" alt="topico">
</div>
<div class="title">Figura 1. Anatomia de um Tópico</div>
</div>
<div class="paragraph">
<p>É importante destacar que o Kafka não garante a ordem global de consumo das mensagens — apenas a ordem sequencial dentro de uma mesma partição.</p>
</div>
<div class="paragraph">
<p>Isso significa que, quando um consumidor se inscreve em um tópico, a ordem sequencial só é garantida se o tópico possuir uma única partição. Se houver múltiplas partições, apenas as mensagens com a mesma chave de partição serão consumidas em sequência, pois serão sempre direcionadas à mesma partição.</p>
</div>
<div class="paragraph">
<p>Dessa forma, o Kafka pode ser utilizado em algoritmos de consenso, uma vez que garante o consumo sequencial de mensagens — desde que elas compartilhem a mesma chave de partição ou o tópico possua apenas uma partição.</p>
</div>
<div class="paragraph">
<p>Outra característica importante dos tópicos do Kafka são os mecanismos de limpeza, controlados pela configuração <code>cleanup.policy</code>. Quando definida como <code>compact</code>, essa política impede o crescimento indefinido do tópico, preservando apenas a última mensagem associada a cada chave.</p>
</div>
<div class="paragraph">
<p>Esse comportamento permite que o tópico funcione como uma espécie de tabela distribuída, que pode ser reconstruída por consumidores a partir do log de eventos. Alguns autores chegam a descrever o Kafka como um "banco de dados invertido" — como se ele utilizasse os mecanismos de sincronização típicos de bancos relacionais, mas aplicados à construção de sistemas distribuídos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/database-inverted.png" alt="database inverted">
</div>
<div class="title">Figura 2. Kafka como base de dados invertida</div>
</div>
<div class="paragraph">
<p>Você já deve ter percebido onde quero chegar: é possível construir uma tabela distribuída de chave-valor com durabilidade usando o Kafka. Agora, só nos resta resolver a eleição do líder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_leader-election-eleição-do-líder">Leader Election (Eleição do Líder)</h3>
<div class="paragraph">
<p>Para implementar as funcionalidades (i) e (ii), precisamos de um mecanismo de troca de mensagens que seja distribuído e garanta ordem sequencial. Cada participante deve ser capaz de enviar mensagens e consumi-las de forma assíncrona.</p>
</div>
<div class="paragraph">
<p>Nosso cliente de consenso utilizará dois canais de comunicação: as requisições são enviadas por um produtor e consumidas por um consumidor. No momento do envio, não conhecemos o estado atual da aplicação. Porém, ao consumir as mensagens, temos a garantia de que todos os participantes estão processando o mesmo conjunto de mensagens, na mesma ordem.</p>
</div>
<div class="paragraph">
<p>Para isso, o algoritmo deve operar através de um tópico de controle com apenas uma partição. Além disso, cada consumidor deve atuar de forma independente — ou seja, sem usar grupos de consumidores —, assegurando que todos recebam e processem integralmente todas as mensagens.</p>
</div>
<div class="paragraph">
<p>A figura abaixo ilustra esse comportamento. Os sistemas <strong>S1</strong> e <strong>S2</strong> enviam as mensagens <strong>REQ_1</strong> e <strong>REQ_2</strong>, respectivamente, e ambos consomem do tópico de controle as requisições na ordem <strong>REQ_1</strong> → <strong>REQ_2</strong>. Dessa forma, tanto <strong>S1</strong> quanto <strong>S2</strong> terão ciência de que <strong>REQ_1</strong> foi enviada e processada antes de <strong>REQ_2</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/topico-controle.png" alt="topico controle">
</div>
<div class="title">Figura 3. Kafka sendo usado como tópico de controle</div>
</div>
<div class="paragraph">
<p>É importante destacar que timestamps têm utilidade limitada em sistemas distribuídos, já que cada máquina possui seu próprio relógio independente — como já discuti no post <a href="https://blog.vepo.dev/posts/relogios-fisicos-e-logicos">Relógios Físicos e Lógicos</a>.</p>
</div>
<div class="paragraph">
<p>No Kafka, a ordem cronológica dos eventos é determinada pela ordem de recebimento no <em>broker</em>, refletida no <em>offset</em> da mensagem. Todos os consumidores recebem as mensagens em ordem crescente de <em>offset</em> e partição, garantindo uma visão consistente e sequencial do fluxo de eventos.</p>
</div>
<div class="paragraph">
<p>Conhecendo esse comportamento do Kafka, podemos implementar um mecanismo de eleição de líder (<em>leader election</em>) baseado no envio e consumo de requisições. Cada processo participante que deseja se tornar líder envia uma requisição de candidatura ao tópico de controle. Da mesma forma, ao finalizar sua atuação como líder, o processo deve enviar uma requisição de renúncia.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/leader-election.png" alt="leader election">
</div>
<div class="title">Figura 4. Diagrama de Sequência da Eleição do Líder</div>
</div>
<div class="paragraph">
<p>Na implementação da eleição de líder, a Fila de Requisições será atualizada exclusivamente pela Thread de Consumo. Essa thread é responsável por consumir mensagens do tópico de controle, adicionar novas requisições à fila e removê-las quando identificar uma mensagem de liberação.</p>
</div>
<div class="paragraph">
<p>A thread da aplicação deverá enviar uma mensagem de requisição de liderança e aguardar até que essa mensagem se torne a primeira da fila. Quando isso ocorrer, significa que todos os demais processos participantes já enviaram suas requisições e eventuais mensagens de liberação de liderança — garantindo assim que a eleição foi consolidada.</p>
</div>
<div class="paragraph">
<p>As imagens a seguir ilustram o processo de gerenciamento da fila de requisições.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/leader-election-queue-1.png" alt="leader election queue 1">
</div>
<div class="title">Figura 5. Quando os Sistemas A, B e E enviam requisições ao mesmo tempo, elas são ordenadas pelo consumidor e o primeiro a enviar se torna líder. No caso o sistema A.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/leader-election-queue-2.png" alt="leader election queue 2">
</div>
<div class="title">Figura 6. Quando o Sistema A envia a mensagem de abdicar a posição de líder, o Sistema B se torna o Líder.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/leader-election-queue-3.png" alt="leader election queue 3">
</div>
<div class="title">Figura 7. Quando o Sistema B envia a mensagem de abdicar a posição de líder, o Sistema C se torna o Líder.</div>
</div>
<div class="paragraph">
<p>Você pode ter notado que este algoritmo ainda não está completo. Para que funcione corretamente, precisamos tratar duas situações críticas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>O que ocorre se um sistema enviar uma requisição e parar de funcionar?</p>
</li>
<li>
<p>Como lidar quando um sistema envia múltiplas requisições?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Para resolver o primeiro caso, enquanto o sistema aguarda para se tornar líder ou durante sua atuação como líder, ele deve enviar mensagens de <em>heartbeat</em> periodicamente. Cada requisição terá uma validade máxima de 2 segundos — caso o sistema não renove o <em>heartbeat</em> dentro desse intervalo, a requisição será removida da fila.</p>
</div>
<div class="paragraph">
<p>Além disso, quando um sistema detecta que uma requisição expirou, ele deve notificar os demais participantes por meio de uma mensagem de remoção. Isso evita que os outros processos precisem aguardar o tempo total de expiração ao consumirem as requisições, acelerando a resposta do sistema como um todo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/kafka/leader-election-dead.png" alt="leader election dead">
</div>
<div class="title">Figura 8. Diagrama de Sequência para quando um dos participantes falhar logo após virar líder, sem enviar as mensagens <em>heartbeat</em>.0</div>
</div>
<div class="paragraph">
<p>É crucial que a mensagem de <em>heartbeat</em> seja enviada com uma frequência superior ao tempo de expiração da requisição. Dessa forma, garante-se que o sistema tenha oportunidade de renovar sua presença antes que a requisição seja considerada inválida.</p>
</div>
<div class="paragraph">
<p>Já o segundo caso pode ser resolvido através de uma modelagem adequada da mensagem de requisição. Cada mensagem deve possuir:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uma chave única compartilhada por todos os participantes</p>
</li>
<li>
<p>Um campo <code>id</code> que identifique o participante</p>
</li>
<li>
<p>Um campo <code>seq</code> com um número sequencial para controlar a liberação da requisição</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Uma requisição será considerada expirada nas seguintes situações:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ao receber um <em>heartbeat</em> com o mesmo <code>id</code> e um valor de <code>seq</code> superior ao da requisição;</p>
</li>
<li>
<p>Ao receber uma mensagem de <code>LeaderRelease</code> com o mesmo <code>id</code> e <code>seq</code> maior ou igual ao da requisição.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vale destacar que, logicamente, uma mensagem de <code>LeaderRelease</code> só é enviada quando o processo já atua como líder. Isso estabelece uma ordenação lógica entre as mensagens, onde a liberação pressupõe que a liderança foi previamente adquirida.</p>
</div>
</div>
<div class="sect2">
<h3 id="_memória-compartilhada">Memória Compartilhada</h3>
<div class="paragraph">
<p>Uma vez eleito líder, o processo pode assumir que consumiu todas as mensagens de líderes anteriores. Dessa forma, o tópico de controle passa a funcionar como uma memória compartilhada, na qual qualquer valor pode ser publicado — utilizando uma chave específica para controlar o acesso a cada elemento compartilhado.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka-como-plataforma-de-consenso">Kafka como Plataforma de Consenso</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementar consenso distribuído é desafiador. Esta solução com Kafka é uma opção elegante quando você já está imerso no nosso ecossistema, mas é importante avaliar se a complexidade justifica o benefício para o caso de uso. Para necessidades mais simples, um serviço gerenciado como o Redis ou Zookeeper (quando viável) pode ser mais adequado.</p>
</div>
<div class="paragraph">
<p>O importante é lembrar que em sistemas distribuídos, nada é simples. A coordenação tem um custo, seja em complexidade, latência ou manutenção. Cabe a nós, engenheiros de software, escolher a moeda de troca mais adequada para cada contexto.</p>
</div>
</div>
</div>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Ciência da Computação" /><category term="Sistemas Distribuídos" /><category term="Microsserviços" /><summary type="html"><![CDATA[Quando trabalhamos com sistemas distribuídos, muitas vezes precisamos de uma maneira de gerar números sequenciais únicos para identificar objetos. Existem diversas formas de implementar isso, mas as vezes algumas limitações técnicas nos obrigam a usar sistemas como o Apache Kafka para essa tarefa.]]></summary></entry></feed>