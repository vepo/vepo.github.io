<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://blog.vepo.dev/feed/by_tag/Debugging.xml" rel="self" type="application/atom+xml" /><link href="https://blog.vepo.dev/" rel="alternate" type="text/html" /><updated>2025-10-07T11:58:40+00:00</updated><id>https://blog.vepo.dev/feed/by_tag/Debugging.xml</id><title type="html">vepo</title><subtitle>Um repositório para todos os posts, palestras e tutoriais que já fiz. Java, Desenvolvimento de Software e reflexões sobre filosofia</subtitle><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><entry><title type="html">Debugando ou Troubleshooting</title><link href="https://blog.vepo.dev/posts/debugando-ou-troubleshooting" rel="alternate" type="text/html" title="Debugando ou Troubleshooting" /><published>2020-05-29T00:00:00+00:00</published><updated>2020-05-29T00:00:00+00:00</updated><id>https://blog.vepo.dev/posts/15-02-56-debugando-ou-troubleshooting</id><content type="html" xml:base="https://blog.vepo.dev/posts/debugando-ou-troubleshooting"><![CDATA[<p>Uma das funções de um desenvolvedor Sênior é fazer o time andar. Além dele ser melhorar a comunicação interna do time, será responsável também por não deixar o time parar. É aí que entra o <em>Debug</em>, <em>Troubleshooting</em>… ou em bom português Resolução de Problemas.</p>

<p>Fazer troubleshooting é quase como investigar um crime. Você precisa tem muito conhecimento do que estava acontecendo, muito conhecimento do local e ir seguindo rastros.</p>

<p>Então vamos lá em dicas de como encontrar e resolver problemas.</p>

<h1 id="não-se-contente-com-a-aparência">Não se contente com a aparência</h1>

<p>Muito tempo atrás, um um mundo onde <em>git</em> e <em>agile</em> ainda eram palavras exóticas, existia o <em>Waterfall</em>. <em>Waterfall</em> é o famoso processo de desenvolvimento que cada fase dura ao menos 3 meses. Você passa 3 semanas planejando, 2 meses desenvolvendo e uma semana testando. É uma loucura, literalmente. Mas tem uma coisa que o <em>Waterfall</em> me ensinou que eu nunca esqueço: <em>Root Cause Analysis</em>.</p>

<p>Recebíamos um <strong>CR</strong> (<em>Change Request</em>) e antes de receber um branch pra desenvolver precisávamos fazer uma análise minuciosa da causa do problema em uma ferramenta web rudimentar.</p>

<p>Vamos propor um problema: um simples <em>NullPointerException</em>.</p>

<p>Na hora um júnior falaria pra colocar uma verificação de <code class="language-plaintext highlighter-rouge">null</code> e pronto.</p>

<p>Mas uma boa Análise de Causa Raiz, pelo nome já diz que essa solução é inválida. Para fazer essa análise, você tem que fazer perguntas ao sistema:</p>

<ol>
  <li>De onde vem esse valor <code class="language-plaintext highlighter-rouge">null</code>?</li>
  <li>Ele pode ser <code class="language-plaintext highlighter-rouge">null</code>? Ou deve sempre vir com algum valor?</li>
  <li>Caso seja <code class="language-plaintext highlighter-rouge">null</code>, qual o comportamento do sistema?</li>
</ol>

<p>Dependendo das respostas acima, é bem provável que a solução proposta mude. Até porque você pode se perguntar: <em>Porque o cara que desenvolveu isso não o fez?</em> Óbvio?</p>

<p>Pois bem, um Sênior não se contenta com análises superficiais. Vai investigar.</p>

<h1 id="análise-de-logs">Análise de logs</h1>

<p>Um Sênior sabe ler logs, mesmo que não seja de aplicações dele. Logs são o registro factual e uma execução. O passo a passo para um bug. Um log, em si, já diz muita coisa, mas se associarmos um log com o código temos tudo!</p>

<p>Mas como ler um log? Vamos lá….</p>

<ol>
  <li>Encontre onde deu o problema</li>
  <li>Analise a código levante algumas suposições</li>
  <li>Retroceda no log, acompanhando com os trechos de código e validando suas suposições</li>
  <li>Caso consiga uma suposição valida, crie um teste unitário que recria o estado da execução</li>
</ol>

<p>Fazer esses quatro passos exige muito treino. A principio é difícil analisar log, mas com o tempo vai se pegando o jeito e só de olhar o código é possível supor alguns possíveis problemas.</p>

<h1 id="deixe-rastros">Deixe Rastros</h1>

<p>Pior do que analisar logs é não ter logs para analisar. <a href="https://dev.to/vepo/deixando-rastros-ou-como-usar-log-peg">Nesse post expliquei como usar Log em Java</a>.</p>

<p>Log consome performance, caso você não use log por causa disso, você não sabe usar log!</p>

<p>Antes vamos entender os níveis de log…</p>

<h2 id="níveis-de-log">Níveis de log</h2>

<p>Em Java temos uma biblioteca padrão de log, a <a href="http://www.slf4j.org/">SLF4J</a>, eu recomendo que você a use, escolha uma implementação, mas pode olhar um benchmark.</p>

<p>Cada mensagem de log tem um nível associado. No SLF4J há os seguintes:</p>

<table>
  <thead>
    <tr>
      <th>Nivel</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>TRACE</td>
      <td>O mais interno. Use-o quando você quer marcar trechos de código executados. Por exemplo: “Iniciando getUsers”</td>
    </tr>
    <tr>
      <td>DEBUG</td>
      <td>Use-o para imprimir valores de variáveis durante a execução.</td>
    </tr>
    <tr>
      <td>INFO</td>
      <td>Use-o para imprimir informações uteis para a execução de informações. Em casos excepcionais, esse nível de log pode ser usado em produção.</td>
    </tr>
    <tr>
      <td>WARN</td>
      <td>Opa! Alguma coisa não devia ter acontecido. Porque? É bom investigar! Use esse nível para marcar comportamento inesperado, mas que não deram erro. Normalmente é aquela situação que pode ser contornada.</td>
    </tr>
    <tr>
      <td>ERROR</td>
      <td>Opa! Erro inesperado! Não fique logando com log erros esperados. Um ERROR já é sinal de um Bug…. Ou é um erro na lógica, ou algum serviço falhou!</td>
    </tr>
  </tbody>
</table>

<p>Use esses serviços sem cerimonia, para garantir a performance você deve configurar o nível de log de acordo com os ambientes. E, por favor, faça a <a href="https://12factor.net/pt_br/config">configuração ser por variável de ambiente</a>, <a href="https://12factor.net/pt_br/dev-prod-parity">nada de uma build pra cada ambiente!</a>.</p>

<p>O que eu costumo fazer:</p>

<table>
  <thead>
    <tr>
      <th>Nivel</th>
      <th>Ambiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>TRACE</td>
      <td>Desenvolvimento em debugging</td>
    </tr>
    <tr>
      <td>DEBUG</td>
      <td>Desenvolvimento, Staging</td>
    </tr>
    <tr>
      <td>INFO</td>
      <td>Testes, Staging, UAT</td>
    </tr>
    <tr>
      <td>WARN</td>
      <td>Produção</td>
    </tr>
    <tr>
      <td>ERROR</td>
      <td>Oi? Vai ignorar os warnings?</td>
    </tr>
  </tbody>
</table>

<p>Os Níveis de log da produção eu baixo esporadicamente para determinados modulos somente quando há um Bug em Produção que não consigo reproduzir localmente. Mas é somente até conseguir encontrar registro do erro. Depois volta para WARN.</p>

<h1 id="conheça-o-código">Conheça o Código</h1>

<p>Muitos desenvolvedores consideram um produto/biblioteca/framework uma caixa preta. Trabalham na base do input/output. Essa abordagem é necessária quando se tem muito conhecimento a reter. Quando eu inicio o uso de um produto/biblioteca/framework eu tomo essa abordagem, mas com o andamento do projeto precisamos de mais informações.</p>

<p>O conhecimento do funcionamento interno de todo o projeto é necessário para entender possíveis erros. Quando há um erro em produção, 1h é bastante tempo, logo tem que se ter uma boa ideia de tudo. O que pode tá errado?</p>

<p>Um dica é aos poucos ir lendo os códigos que você usa como caixa preta. Mesmo que você não entenda, vá lendo e vendo o que ele faz com seus inputs.</p>

<p>Quando estava desenvolvendo a Engine de Processos de Negócios de uma antiga empresa que trabalhei, enfretamos um grande problema de Memory Leak. Em resumo, toda intergração de negócio era escrita em XML e associado código Java. Assim um cara do comercial podia entender as integrações bizarras que existiam.</p>

<p>Para fazer com que <code class="language-plaintext highlighter-rouge">if</code>, <code class="language-plaintext highlighter-rouge">case</code>, <code class="language-plaintext highlighter-rouge">switch</code>, <code class="language-plaintext highlighter-rouge">for</code>, etc… fosse colocados em XML, usamos o <a href="http://commons.apache.org/proper/commons-jexl/"><strong>Java Expression Language (JEXL)</strong></a> da Apache.</p>

<p>Estava tudo indo certo até ir para Produção. Mas o negócio não ficava de pé por alguns dias. Estourava a memória. Depois de uma analise bem detalhada, percebi que não era no nosso código. Até encontrar que na limpesza do cache do JEXL, eles não limpavam as referências as classes utilizadas. Assim, se usassemos ClassLoaders dinamicos, como era uma escolha arquitetural nossa, ficavamos com muito lixo na Heap. Entendeu? Se não depois falo sobre Gerenciamento de Memória no Java.</p>

<p>E agora, como resolver? Bom, tive que abrir os objetos pro Reflection, violando todos os principios de OOP para limpar o cache. E funcionou!</p>

<p>Não dá pra garantir que exista um software sem erros, conhecer as suas dependências é um requisito.</p>

<h1 id="conclusão">Conclusão</h1>

<p>Um Sênior deve saber resolver os problemas do time. Deve ser um guia para criar meios de deixar rastros e entender o que está acontecendo. Troubleshooting é difícil, mas é uma prática.</p>

<p>Leia código, tente executar eles na sua mente. Simule execuções baseada em logs.</p>]]></content><author><name>{&quot;twitter&quot;=&gt;&quot;vepo&quot;, &quot;linkedin&quot;=&gt;&quot;https://www.linkedin.com/in/victorosorio/&quot;, &quot;picture&quot;=&gt;&quot;/assets/images/me.avif&quot;}</name></author><category term="Troubleshooting" /><category term="Debugging" /><category term="Logging" /><summary type="html"><![CDATA[Um Sênior deve saber fazer troubleshooting. Aqui vão algumas dicas.]]></summary></entry></feed>